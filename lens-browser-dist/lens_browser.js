!function t(e,n,r){function i(o,a){if(!n[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t){window.LensBrowser=t("./src/lens_browser")},{"./src/lens_browser":26}],2:[function(t,e){e.exports={api_url:"https://elife-lens-indexer.herokuapp.com"}},{}],3:[function(t,e){"use strict";var n=t("./src/application");n.View=t("./src/view"),n.Controller=t("./src/controller"),"undefined"!=typeof window&&(n.Router=t("./src/router"),n.DefaultRouter=t("./src/default_router"),n.ElementRenderer=t("./src/renderers/element_renderer"),n.$$=n.ElementRenderer.$$),e.exports=n},{"./src/application":4,"./src/controller":5,"./src/default_router":6,"./src/renderers/element_renderer":7,"./src/router":8,"./src/view":9}],4:[function(t,e){"use strict";var n=t("./view"),r=t("substance-util"),i=t("underscore"),s=function(t){n.call(this),this.config=t||{},this.__controller__=null};s.Prototype=function(){this.setRouter=function(t){this.router=t},this.start=function(t){var e=window.$;t=t||{},t.el?(this.el=t.el,this.$el=e(this.el)):(this.$el=e("body"),this.el=this.$el[0]),this.initialize&&this.initialize(),this.render&&this.render(),this.router&&this.router.start()};var t={updateRoute:!0,replace:!1};this.switchState=function(e,n,s){e=JSON.parse(JSON.stringify(e));var o=this;n=i.extend({},t,n||{});var a=this.getState();this.controller.__switchState__(e,n,function(t){if(t)return void(s?s(t):(console.error(t.message),r.printStackTrace(t)));if(n.updateRoute&&o.updateRoute(n),o.afterTransition)try{o.afterTransition(e,a)}catch(i){return void(s?s(i):(console.error(i.message),r.printStackTrace(i)))}s&&s(null)})},this.stateFromFragment=function(t){function e(t){for(var e=[],n=0;n<t.length;n++)e.push({id:t[n]});return e}var n,r,i,s=t.split(";"),o=[];for(r=0;r<s.length;r++){i=s[r].split("=");var a=i[0],c=i[1];if(a&&void 0!==c)if("state"===a){var u=c.split(".");n=e(u)}else i=a.split("."),o.push({state:i[0],key:i[1],value:c})}for(r=0;r<o.length;r++){var l=o[r],h=n[l.state],f=l.value;f=window.decodeURIComponent(f);var c=JSON.parse(f);h[l.key]=c}return n},this.getState=function(){if(!this.controller.state)return null;for(var t=[],e=this.controller;e;)t.push(e.state),e=e.childController;return t},this.updateRoute=function(t){if(!this.router&&!this.config.headless)throw new Error("Application.updateRoute(): application has no router.");t=t||{};for(var e=this.getState(),n=[],r=[],i=0;i<e.length;i++){var s=e[i];if(s){var o=s.id||"default";n.push(o);for(var a in s)if("id"!==a&&"__id__"!==a&&"options"!==a){var c=JSON.stringify(s[a]),u=window.encodeURIComponent(c);r.push(i+"."+a+"="+u)}}}var l="state="+n.join(".")+";"+r.join(";");this.router.navigate(l,{trigger:!1,replace:t.replace})},this.stateChanged=function(t,e,n){n.updateRoute&&this.updateRoute(n)},this.sendError=function(t){throw t}},s.Prototype.prototype=n.prototype,s.prototype=new s.Prototype,Object.defineProperty(s.prototype,"controller",{set:function(t){t.setChangeListener(this),this.__controller__=t},get:function(){return this.__controller__}}),e.exports=s},{"./view":9,"substance-util":12,underscore:20}],5:[function(t,e){"use strict";var n=t("substance-util"),r=t("underscore"),i=function(){this.changeListener=null,this.state={id:"uninitialized"},this.__childController__=null,this.__parentController__=null};i.Prototype=function(){this.intitialize=function(){},this.dispose=function(){this.__childController__&&this.__childController__.dispose(),this.__childController__=null,this.state={id:"uninitialized"}},this.transition=function(t,e){e(null)},this.switchState=function(t,e,i){t=JSON.parse(JSON.stringify(t)),!i&&r.isFunction(e)&&(i=e);var s=this;1===arguments.length&&r.isFunction(e)&&(i=e,e={}),e=e||{updateRoute:!0,replace:!1},i=i||function(r){if(r)throw console.error("Error during switch state",t,e),n.printStackTrace(r),new Error(r)};var o=this.state;this.__switchState__(t,e,function(t){return t?i(t):(s.changeListener&&s.changeListener.stateChanged(this,o,e),void i(null))})},this.__switchState__=function(t,e,n){var i=this;n=n||function(t){if(t)throw new Error(t)},r.isArray(t)||(t=[t]);var s=t.shift();s.options=e||{};var o,a=function(){if(!o){var t=i.state;i.state=s,i.afterTransition(t),i.state.options={}}n(null)},c=function(){try{i.transition(s,function(e,s){if(e)return n(e);if(r.isBoolean(s)?o=s:s&&(o=s.skip),i.childController)if(t.length>0)i.childController.__switchState__(t,s,function(t){return t?n(t):void a()});else{if(!i.childController.DEFAULT_STATE)throw new Error("Unsufficient state data provided! Child controller needs a transition!");i.childController.__switchState__(i.childController.DEFAULT_STATE,s,function(t){return t?n(t):void a()})}else a()})}catch(e){n(e)}};this.state?c():this.initialize(s,function(t){return t?n(t):(i.state={id:"initialized"},void c())})},this.afterTransition=function(){},this.setChildController=function(t,e){e=e||{},this.__childController__&&this.__childController__.state&&!e.nowarn&&console.error("The child controller has not been disposed. Call 'disposeChildController()' first."),t&&(this.changeListener?t.changeListener=this.changeListener:console.error("This controller does not have a changeListener attached, so the child controller will not trigger corresponding application state changes."),t.__parentController__=this,this.__childController__=t)},this.disposeChildController=function(){this.__childController__&&(this.__childController__.dispose(),this.__childController__=null)},this.setChangeListener=function(t){this.changeListener=t},this.sendError=function(t){this.__parentController__&&this.__parentController__.sendError(t)}},i.Prototype.prototype=n.Events,i.prototype=new i.Prototype,i.State=function(t){if(r.isString(t))this.__id__=t;else{var e=arguments[0];this.__id__=e.id,r.each(e,function(t,e){"id"!==e&&(this[e]=t)},this)}},Object.defineProperty(i.State.prototype,"id",{set:function(){throw new Error("Property 'id' is immutable")},get:function(){return this.__id__}}),Object.defineProperty(i.prototype,"childController",{set:function(t){this.setChildController(t)},get:function(){return this.__childController__}}),e.exports=i},{"substance-util":12,underscore:20}],6:[function(t,e){"use strict";var n=t("underscore"),r=t("./router"),i=function(t){r.call(this),this.app=t,n.each(i.routes,function(t){this[t.command]?this.route(t.route,t.name,n.bind(this[t.command],this)):console.error("Unknown route handler: ",t.command)},this),this.route(/^state=.*$/,"state",n.bind(this.openState,this))};i.Prototype=function(){this.start=function(){r.history.start()};var t={updateRoute:!1,replace:!1};this.openState=function(){var e=r.history.getFragment(),n=this.app.stateFromFragment(e);console.log("state change triggerd by router",JSON.stringify(n)),this.app.switchState(n,t)},this.navigate=function(t,e){r.history.navigate(t,e)}},i.Prototype.prototype=r.prototype,i.prototype=new i.Prototype,e.exports=i},{"./router":8,underscore:20}],7:[function(t,e){"use strict";var n=t("substance-util"),r=t("substance-regexp"),i=function(t){return this.attributes=t,this.tagName=t.tag,this.children=t.children||[],this.text=t.text||"",this.html=t.html,delete t.children,delete t.text,delete t.html,delete t.tag,this.render()};i.Prototype=function(){this.render=function(){var t=window.document.createElement(this.tagName);this.html?t.innerHTML=this.html:t.textContent=this.text;for(var e in this.attributes){var n=this.attributes[e];t.setAttribute(e,n)}for(var r=0;r<this.children.length;r++){var i=this.children[r];t.appendChild(i)}return this.el=t,t}};var s=function(t,e){e=e||{};var n=/^([a-zA-Z0-9]*)/.exec(t);e.tag=n&&n[1]?n[1]:"div";var s=/#([a-zA-Z0-9_]*)/.exec(t);s&&s[1]&&(e.id=s[1]);var o=new r(/\.([a-zA-Z0-9_-]*)/g);return e.class||(e.class=o.match(t).map(function(t){return t.match[1]}).join(" ")),new i(e)};i.$$=s,i.Prototype.prototype=n.Events,i.prototype=new i.Prototype,e.exports=i},{"substance-regexp":10,"substance-util":12}],8:[function(t,e){"use strict";var n,r=t("substance-util"),i=t("underscore");"undefined"!=typeof window?n=window.$:(console.error("FIXME: require router.js only when you are in a window context."),n=null);var s=function(t){t=t||{},t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},o=/\((.*?)\)/g,a=/(\(\?)?:\w+/g,c=/\*\w+/g,u=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(s.prototype,r.Events,{initialize:function(){},route:function(t,e,n){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(e)&&(n=e,e=""),n||(n=this[e]);var r=this;return s.history.route(t,function(i){var o=r._extractParameters(t,i);n&&n.apply(r,o),r.trigger.apply(r,["route:"+e].concat(o)),r.trigger("route",e,o),s.history.trigger("route",r,e,o)}),this},navigate:function(t,e){return s.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!==(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(u,"\\$&").replace(o,"(?:$1)?").replace(a,function(t,e){return e?t:"([^/]+)"}).replace(c,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,function(t){return t?decodeURIComponent(t):null})}});var l=s.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},h=/^[#\/]|\s+$/g,f=/^\/+|\/+$/g,p=/msie [\w.]+/,d=/\/$/;l.started=!1,i.extend(l.prototype,r.Events,{interval:50,getHash:function(t){var e=(t||window).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null===t||void 0===t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var n=this.root.replace(d,"");t.indexOf(n)||(t=t.substr(n.length))}else t=this.getHash();return t.replace(h,"")},start:function(t){if(l.started)throw new Error("Router.history has already been started");l.started=!0,this.options=i.extend({},{root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment(),r=window.document.documentMode,s=p.exec(window.navigator.userAgent.toLowerCase())&&(!r||7>=r);this.root=("/"+this.root+"/").replace(f,"/"),s&&this._wantsHashChange&&(this.iframe=n('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?n(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?n(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e;var o=this.location,a=o.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&o.hash&&(this.fragment=this.getHash().replace(h,""),this.history.replaceState({},window.document.title,this.root+this.fragment+o.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){n(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),l.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=i.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,e){if(!l.started)return!1;if(e&&e!==!0||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){this.fragment=t;var n=this.root+t;if(this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},window.document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}e.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,n){if(n){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else t.hash="#"+e}}),s.history=new l,e.exports=s},{"substance-util":12,underscore:20}],9:[function(t,e){"use strict";var n=t("substance-util"),r=function(){this.$el=window.$("<div/>"),this.el=this.$el[0],this.dispatchDOMEvents()};r.Prototype=function(){this.dispose=function(){this.stopListening()},this.$=function(t){return this.$el.find(t)},this.dispatchDOMEvents=function(){function t(t){var e=/(\w+)\((.*)\)/.exec(t);if(!e)throw new Error("Invalid click handler '"+t+"'");return{method:e[1],args:e[2].split(",")}}var e=this;this.$el.delegate("[sbs-click]","click",function(n){var r=t(window.$(n.currentTarget).attr("sbs-click")),i=e[r.method];return i?(i.apply(e,r.args),!1):void 0})},this.updateTitle=function(t){window.document.title=t,window.history.replaceState({},window.document.title,window.location.href)}},r.Prototype.prototype=n.Events,r.prototype=new r.Prototype,e.exports=r},{"substance-util":12}],10:[function(t,e){"use strict";e.exports=t("./src/regexp")},{"./src/regexp":11}],11:[function(t,e){"use strict";var n=function(t){this.index=t.index,this.match=[];for(var e=0;e<t.length;e++)this.match.push(t[e])};n.Prototype=function(){this.captures=function(){return this.match.slice(1)},this.toString=function(){return this.match[0]}},n.prototype=new n.Prototype;var r=function(t){this.exp=t};r.Prototype=function(){this.match=function(t){if(void 0===t)throw new Error("No string given");if(this.exp.global){var e,r=[];for(this.exp.compile(this.exp);null!==(e=this.exp.exec(t));)r.push(new n(e));return r}return this.exp.exec(t)}},r.prototype=new r.Prototype,r.Match=n,e.exports=r},{}],12:[function(t,e){"use strict";var n=t("./src/util");n.async=t("./src/async"),n.errors=t("./src/errors"),n.html=t("./src/html"),n.dom=t("./src/dom"),n.RegExp=t("./src/regexp"),n.Fragmenter=t("./src/fragmenter"),e.exports=n},{"./src/async":13,"./src/dom":14,"./src/errors":15,"./src/fragmenter":16,"./src/html":17,"./src/regexp":18,"./src/util":19}],13:[function(t,e){"use strict";function n(t,e){function n(t){var e=a[c];if(!e)return l.length>0?r(new Error("Multiple errors occurred.",t)):r(null,t);var o=i.once(function(t,e){if(t){if(u)return r(t,null);l.push(t)}c+=1,n(e)});try{0===e.length?(e(),o(null,t)):1===e.length?e(o):e(t,o)}catch(h){console.log("util.async caught error:",h),s.printStackTrace(h),r(h)}}var r=t["finally"]||function(t,n){e(t,n)};r=i.once(r);var o=t.data||{},a=t.functions;if(!i.isFunction(e))return e("Illegal arguments: a callback function must be provided");var c=0,u=void 0===t.stopOnError?!0:t.stopOnError,l=[];n(o)}function r(t){return function(e,r){function s(t,e){return function(n,r){2===h.length?h(t,r):3===h.length?h(t,e,r):h(t,e,n,r)}}function o(t,e){return function(n,r){2===h.length?h(t,r):3===h.length?h(t,e,r):h(t,e,n,r)}}var a=t.selector?t.selector(e):t.items,c=t["finally"]||function(t,e){r(t,e)};if(c=i.once(c),!a)return c(null,e);var u=i.isArray(a);t.before&&t.before(e);var l=[],h=t.iterator;if(u)for(var f=0;f<a.length;f++)l.push(s(a[f],f));else for(var p in a)l.push(o(a[p],p));var d={functions:l,data:e,"finally":c,stopOnError:t.stopOnError};n(d,r)}}var i=t("underscore"),s=t("./util.js"),o={};o.sequential=function(t,e){i.isArray(t)&&(t={functions:t}),n(t,e)},o.iterator=function(t,e){var n;return n=1==arguments.length?t:{items:t,iterator:e},r(n)},o.each=function(t,e){var n=r(t);n(null,e)},e.exports=o},{"./util.js":19,underscore:20}],14:[function(t,e){"use strict";var n=t("underscore"),r={};r.ChildNodeIterator=function(t){this.nodes=n.isArray(t)?t:t.childNodes,this.length=this.nodes.length,this.pos=-1},r.ChildNodeIterator.prototype={hasNext:function(){return this.pos<this.length-1},next:function(){return this.pos+=1,this.nodes[this.pos]},back:function(){return this.pos>=0&&(this.pos-=1),this}},r.getChildren=function(t){if(void 0!==t.children)return t.children;for(var e=[],n=t.firstElementChild;n;)e.push(n),n=n.nextElementSibling;return e},r.getNodeType=function(t){return t.nodeType===window.Node.TEXT_NODE?"text":t.nodeType===window.Node.COMMENT_NODE?"comment":t.tagName?t.tagName.toLowerCase():(console.error("Can't get node type for ",t),"unknown")},e.exports=r},{underscore:20}],15:[function(t,e){"use strict";var n=t("./util"),r={},i=function(t,e){e?(Error.call(this,t,e.fileName,e.lineNumber),this.__stack=e instanceof i?e.__stack:e.stack?n.parseStackTrace(e):n.callstack(1)):(Error.call(this,t),this.__stack=n.callstack(1)),this.message=t};i.Prototype=function(){this.name="SubstanceError",this.code=-1,this.toString=function(){return this.name+":"+this.message},this.toJSON=function(){return{name:this.name,message:this.message,code:this.code,stack:this.stack}},this.printStackTrace=function(){n.printStackTrace(this)}},i.Prototype.prototype=Error.prototype,i.prototype=new i.Prototype,Object.defineProperty(i.prototype,"stack",{get:function(){for(var t=[],e=0;e<this.__stack.length;e++){var n=this.__stack[e];t.push(n.file+":"+n.line+":"+n.col+" ("+n.func+")")}return t.join("\n")},set:function(){throw new Error("SubstanceError.stack is read-only.")}}),r.SubstanceError=i;var s=function(t,e,n){return function(r){t.call(this,r),this.name=e,this.code=n}};r.define=function(t,e,n){if(!t)throw new i("Name is required.");void 0===e&&(e=-1),n=n||i;var o=s(n,t,e),a=function(){};return a.prototype=n.prototype,o.prototype=new a,o.prototype.constructor=o,r[t]=o,o},e.exports=r},{"./util":19}],16:[function(t,e){"use strict";var n=t("underscore"),r=1,i=-1,s=function(t){this.levels=t||{}};s.Prototype=function(){var t=function(t,e){if(t.pos<e.pos)return-1;if(t.pos>e.pos)return 1;if(t.mode<e.mode)return-1;if(t.mode>e.mode)return 1;if(t.mode===r){if(t.level<e.level)return-1;if(t.level>e.level)return 1}if(t.mode===i){if(t.level>e.level)return-1;if(t.level<e.level)return 1}return 0},e=function(t){var e=[];return n.each(t,function(t){var n=this.levels[t.type]||1e3;void 0!==n&&(e.push({pos:t.range[0],mode:r,level:n,id:t.id,type:t.type,node:t}),e.push({pos:t.range[1],mode:i,level:n,id:t.id,type:t.type,node:t}))},this),e};this.onText=function(){},this.onEnter=function(){return null},this.onExit=function(){},this.enter=function(t,e){return this.onEnter(t,e)},this.exit=function(t,e){this.onExit(t,e)},this.createText=function(t,e){this.onText(t,e)},this.start=function(n,s,o){var a=e.call(this,o);a.sort(t.bind(this));for(var c=[{context:n,entry:null}],u=0,l=0;l<a.length;l++){var h=a[l];this.createText(c[c.length-1].context,s.substring(u,h.pos)),u=h.pos;var f,p=1;if(h.mode===r){for(;p<c.length&&!(h.level<c[p].entry.level);p++);c.splice(p,0,{entry:h})}else if(h.mode===i){for(;p<c.length&&c[p].entry.id!==h.id;p++);for(f=p;f<c.length;f++)this.exit(c[f].entry,c[f-1].context);c.splice(p,1)}for(f=p;f<c.length;f++)c[f].context=this.enter(c[f].entry,c[f-1].context)}this.createText(n,s.substring(u))}},s.prototype=new s.Prototype,e.exports=s},{underscore:20}],17:[function(t,e){"use strict";var n={},r=t("underscore");n.templates={},n.renderTemplate=function(t,e){return n.templates[t](e)},"undefined"!=typeof window&&(window.console||(window.console={log:function(){}})),n.tpl=function(t,e){e=e||{};var n=window.$("script[name="+t+"]").html();return r.template(n,e)},e.exports=n},{underscore:20}],18:[function(t,e){"use strict";var n=function(t){this.index=t.index,this.match=[];for(var e=0;e<t.length;e++)this.match.push(t[e])};n.Prototype=function(){this.captures=function(){return this.match.slice(1)},this.toString=function(){return this.match[0]}},n.prototype=new n.Prototype;var r=function(t){this.exp=t};r.Prototype=function(){this.match=function(t){if(void 0===t)throw new Error("No string given");if(this.exp.global){var e,r=[];for(this.exp.compile(this.exp);null!==(e=this.exp.exec(t));)r.push(new n(e));return r}return this.exp.exec(t)}},r.prototype=new r.Prototype,r.Match=n,e.exports=r},{}],19:[function(t,e){"use strict";var n=t("underscore"),r={};r.uuid=function(t,e){var n,r="0123456789abcdefghijklmnopqrstuvwxyz".split(""),i=[],s=16;if(e=e||32)for(n=0;e>n;n++)i[n]=r[0|Math.random()*s];else{var o;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",n=0;36>n;n++)i[n]||(o=0|16*Math.random(),i[n]=r[19==n?3&o|8:o])}return(t?t:"")+i.join("")},r.uuidGen=function(t){var e=1;return t=void 0!==t?t:"uuid_",function(n){return n=n||t,n+e++}};var i=function(t,e){var n,r=-1,i=t.length,s=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++r<i;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s);return;case 2:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s,o);return;case 3:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s,o,a);return;default:for(;++r<i;)(n=t[r]).callback.apply(n.ctx,e)}},s=/\s+/,o=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)t[e].apply(t,[i,n[i]].concat(r));return!1}if(s.test(n)){for(var o=n.split(s),a=0,c=o.length;c>a;a++)t[e].apply(t,[o[a]].concat(r));return!1}return!0};r.Events={on:function(t,e,n){if(!o(this,"on",t,[e,n])||!e)return this;this._events=this._events||{};var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,r){if(!o(this,"once",t,[e,r])||!e)return this;var i=this,s=n.once(function(){i.off(t,s),e.apply(this,arguments)});return s._callback=e,this.on(t,s,r)},off:function(t,e,r){var i,s,a,c,u,l,h,f;if(!this._events||!o(this,"off",t,[e,r]))return this;if(!t&&!e&&!r)return this._events={},this;for(c=t?[t]:n.keys(this._events),u=0,l=c.length;l>u;u++)if(t=c[u],a=this._events[t]){if(this._events[t]=i=[],e||r)for(h=0,f=a.length;f>h;h++)s=a[h],(e&&e!==s.callback&&e!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=Array.prototype.slice.call(arguments,1);if(!o(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&i(n,e),r&&i(r,arguments),this},triggerLater:function(){var t=this,e=arguments;window.setTimeout(function(){t.trigger.apply(t,e)},0)},stopListening:function(t,e,n){var r=this._listeners;if(!r)return this;var i=!e&&!n;"object"==typeof e&&(n=this),t&&((r={})[t._listenerId]=t);for(var s in r)r[s].off(e,n,this),i&&delete this._listeners[s];return this}};var a={listenTo:"on",listenToOnce:"once"};n.each(a,function(t,e){r.Events[e]=function(e,r,i){var s=this._listeners||(this._listeners={}),o=e._listenerId||(e._listenerId=n.uniqueId("l"));return s[o]=e,"object"==typeof r&&(i=this),e[t](r,i,this),this}}),r.Events.bind=r.Events.on,r.Events.unbind=r.Events.off,r.Events.Listener={listenTo:function(t,e,r){if(!n.isFunction(r))throw new Error("Illegal argument: expecting function as callback, was: "+r);return this._handlers=this._handlers||[],t.on(e,r,this),this._handlers.push({unbind:function(){t.off(e,r)}}),this},stopListening:function(){if(this._handlers)for(var t=0;t<this._handlers.length;t++)this._handlers[t].unbind()}},r.propagate=function(t,e){if(!n.isFunction(e))throw"Illegal argument: provided callback is not a function";return function(n){return n?e(n):void e(null,t)}};var c=function(){};r.inherits=function(t,e,r){var i;return i=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},n.extend(i,t),c.prototype=t.prototype,i.prototype=new c,e&&n.extend(i.prototype,e),r&&n.extend(i,r),i.prototype.constructor=i,i.__super__=t.prototype,i},r.getJSON=function(e,n){if("undefined"==typeof window||"undefined"!=typeof nwglobal){var r=t("fs"),i=JSON.parse(r.readFileSync(e,"utf8"));n(null,i)}else{var s=window.$;s.getJSON(e).done(function(t){n(null,t)}).error(function(t){n(t,null)})}},r.prototype=function(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__},r.inherit=function(t,e){var r,i=n.isFunction(t)?new t:t;if(n.isFunction(e))e.prototype=i,r=new e;else{var s=function(){};s.prototype=i,r=n.extend(new s,e)}return r},r.pimpl=function(t){var e=function(t){this.self=t};return e.prototype=t,function(t){return t=t||this,new e(t)}},r.parseStackTrace=function(t){var e,n=/([^@]*)@(.*):(\d+)/,r=/\s*at ([^(]*)[(](.*):(\d+):(\d+)[)]/,i=t.stack.split("\n"),s=[];for(e=0;e<i.length;e++){var o=n.exec(i[e]);o||(o=r.exec(i[e]));var a;o?(a={func:o[1],file:o[2],line:o[3],col:o[4]||0},""===a.func&&(a.func="<anonymous>")):a={func:"",file:i[e],line:"",col:""},s.push(a)}return s},r.callstack=function(t){var e;try{throw new Error}catch(n){e=n}var i=r.parseStackTrace(e);return t=t||0,i.splice(t+1)},r.stacktrace=function(t){var e=0===arguments.length?r.callstack().splice(1):r.parseStackTrace(t),i=[];return n.each(e,function(t){i.push(t.file+":"+t.line+":"+t.col+" ("+t.func+")")}),i.join("\n")},r.printStackTrace=function(t,e){if(t.stack){var i;if(void 0!==t.__stack)i=t.__stack;else{if(!n.isString(t.stack))return;i=r.parseStackTrace(t)}e=e||i.length,e=Math.min(e,i.length);for(var s=0;e>s;s++){var o=i[s];console.log(o.file+":"+o.line+":"+o.col,"("+o.func+")")}}},r.diff=function(t,e){var i;return n.isArray(t)&&n.isArray(e)?(i=n.difference(e,t),0===i.length?null:i):n.isObject(t)&&n.isObject(e)?(i={},n.each(Object.keys(e),function(n){var s=r.diff(t[n],e[n]);s&&(i[n]=s)}),n.isEmpty(i)?null:i):t!==e?e:void 0},r.deepclone=function(t){return void 0===t?void 0:null===t?null:JSON.parse(JSON.stringify(t))},r.clone=function(t){return null===t||void 0===t?t:n.isFunction(t.clone)?t.clone():r.deepclone(t)},r.freeze=function(t){var e;if(n.isObject(t)){if(Object.isFrozen(t))return t;var i=Object.keys(t);for(e=0;e<i.length;e++){var s=i[e];t[s]=r.freeze(t[s])}return Object.freeze(t)}if(n.isArray(t)){var o=t;for(e=0;e<o.length;e++)o[e]=r.freeze(o[e]);return Object.freeze(o)}return t},r.later=function(t,e){return function(){var n=arguments;window.setTimeout(function(){t.apply(e,n)},0)}},r.isEmpty=function(t){return!t.match(/\w/)},r.slug=function(t){t=t.replace(/^\s+|\s+$/g,""),t=t.toLowerCase();for(var e="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",n="aaaaeeeeiiiioooouuuunc------",r=0,i=e.length;i>r;r++)t=t.replace(new RegExp(e.charAt(r),"g"),n.charAt(r));return t=t.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},r.getReadableFileSizeString=function(t){var e=-1,n=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do t/=1024,e++;while(t>1024);return Math.max(t,.1).toFixed(1)+n[e]},e.exports=r},{fs:31,underscore:20}],20:[function(t,e,n){(function(){var t=this,r=t._,i={},s=Array.prototype,o=Object.prototype,a=Function.prototype,c=s.push,u=s.slice,l=s.concat,h=o.toString,f=o.hasOwnProperty,p=s.forEach,d=s.map,g=s.reduce,v=s.reduceRight,y=s.filter,m=s.every,_=s.some,w=s.indexOf,b=s.lastIndexOf,x=Array.isArray,k=Object.keys,S=a.bind,E=function(t){return t instanceof E?t:this instanceof E?void(this._wrapped=t):new E(t)};"undefined"!=typeof n?("undefined"!=typeof e&&e.exports&&(n=e.exports=E),n._=E):t._=E,E.VERSION="1.5.2";var C=E.each=E.forEach=function(t,e,n){if(null!=t)if(p&&t.forEach===p)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,s=t.length;s>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var o=E.keys(t),r=0,s=o.length;s>r;r++)if(e.call(n,t[o[r]],o[r],t)===i)return};E.map=E.collect=function(t,e,n){var r=[];return null==t?r:d&&t.map===d?t.map(e,n):(C(t,function(t,i,s){r.push(e.call(n,t,i,s))}),r)};var F="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),g&&t.reduce===g)return r&&(e=E.bind(e,r)),i?t.reduce(e,n):t.reduce(e);if(C(t,function(t,s,o){i?n=e.call(r,n,t,s,o):(n=t,i=!0)}),!i)throw new TypeError(F);return n},E.reduceRight=E.foldr=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),v&&t.reduceRight===v)return r&&(e=E.bind(e,r)),i?t.reduceRight(e,n):t.reduceRight(e);var s=t.length;if(s!==+s){var o=E.keys(t);s=o.length}if(C(t,function(a,c,u){c=o?o[--s]:--s,i?n=e.call(r,n,t[c],c,u):(n=t[c],i=!0)}),!i)throw new TypeError(F);return n},E.find=E.detect=function(t,e,n){var r;return T(t,function(t,i,s){return e.call(n,t,i,s)?(r=t,!0):void 0}),r},E.filter=E.select=function(t,e,n){var r=[];return null==t?r:y&&t.filter===y?t.filter(e,n):(C(t,function(t,i,s){e.call(n,t,i,s)&&r.push(t)}),r)},E.reject=function(t,e,n){return E.filter(t,function(t,r,i){return!e.call(n,t,r,i)},n)},E.every=E.all=function(t,e,n){e||(e=E.identity);var r=!0;return null==t?r:m&&t.every===m?t.every(e,n):(C(t,function(t,s,o){return(r=r&&e.call(n,t,s,o))?void 0:i}),!!r)};var T=E.some=E.any=function(t,e,n){e||(e=E.identity);var r=!1;return null==t?r:_&&t.some===_?t.some(e,n):(C(t,function(t,s,o){return r||(r=e.call(n,t,s,o))?i:void 0}),!!r)};E.contains=E.include=function(t,e){return null==t?!1:w&&t.indexOf===w?-1!=t.indexOf(e):T(t,function(t){return t===e})},E.invoke=function(t,e){var n=u.call(arguments,2),r=E.isFunction(e);return E.map(t,function(t){return(r?e:t[e]).apply(t,n)})},E.pluck=function(t,e){return E.map(t,function(t){return t[e]})},E.where=function(t,e,n){return E.isEmpty(e)?n?void 0:[]:E[n?"find":"filter"](t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},E.findWhere=function(t,e){return E.where(t,e,!0)},E.max=function(t,e,n){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&E.isEmpty(t))return-1/0;var r={computed:-1/0,value:-1/0};return C(t,function(t,i,s){var o=e?e.call(n,t,i,s):t;o>r.computed&&(r={value:t,computed:o})}),r.value},E.min=function(t,e,n){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&E.isEmpty(t))return 1/0;var r={computed:1/0,value:1/0};return C(t,function(t,i,s){var o=e?e.call(n,t,i,s):t;o<r.computed&&(r={value:t,computed:o})}),r.value},E.shuffle=function(t){var e,n=0,r=[];return C(t,function(t){e=E.random(n++),r[n-1]=r[e],r[e]=t}),r},E.sample=function(t,e,n){return arguments.length<2||n?t[E.random(t.length-1)]:E.shuffle(t).slice(0,Math.max(0,e))};var P=function(t){return E.isFunction(t)?t:function(e){return e[t]}};E.sortBy=function(t,e,n){var r=P(e);return E.pluck(E.map(t,function(t,e,i){return{value:t,index:e,criteria:r.call(n,t,e,i)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return t.index-e.index}),"value")};var $=function(t){return function(e,n,r){var i={},s=null==n?E.identity:P(n);return C(e,function(n,o){var a=s.call(r,n,o,e);t(i,a,n)}),i}};E.groupBy=$(function(t,e,n){(E.has(t,e)?t[e]:t[e]=[]).push(n)}),E.indexBy=$(function(t,e,n){t[e]=n}),E.countBy=$(function(t,e){E.has(t,e)?t[e]++:t[e]=1}),E.sortedIndex=function(t,e,n,r){n=null==n?E.identity:P(n);for(var i=n.call(r,e),s=0,o=t.length;o>s;){var a=s+o>>>1;n.call(r,t[a])<i?s=a+1:o=a}return s},E.toArray=function(t){return t?E.isArray(t)?u.call(t):t.length===+t.length?E.map(t,E.identity):E.values(t):[]},E.size=function(t){return null==t?0:t.length===+t.length?t.length:E.keys(t).length},E.first=E.head=E.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:u.call(t,0,e)},E.initial=function(t,e,n){return u.call(t,0,t.length-(null==e||n?1:e))},E.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:u.call(t,Math.max(t.length-e,0))},E.rest=E.tail=E.drop=function(t,e,n){return u.call(t,null==e||n?1:e)},E.compact=function(t){return E.filter(t,E.identity)};var O=function(t,e,n){return e&&E.every(t,E.isArray)?l.apply(n,t):(C(t,function(t){E.isArray(t)||E.isArguments(t)?e?c.apply(n,t):O(t,e,n):n.push(t)}),n)};E.flatten=function(t,e){return O(t,e,[])},E.without=function(t){return E.difference(t,u.call(arguments,1))
},E.uniq=E.unique=function(t,e,n,r){E.isFunction(e)&&(r=n,n=e,e=!1);var i=n?E.map(t,n,r):t,s=[],o=[];return C(i,function(n,r){(e?r&&o[o.length-1]===n:E.contains(o,n))||(o.push(n),s.push(t[r]))}),s},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=function(t){var e=u.call(arguments,1);return E.filter(E.uniq(t),function(t){return E.every(e,function(e){return E.indexOf(e,t)>=0})})},E.difference=function(t){var e=l.apply(s,u.call(arguments,1));return E.filter(t,function(t){return!E.contains(e,t)})},E.zip=function(){for(var t=E.max(E.pluck(arguments,"length").concat(0)),e=new Array(t),n=0;t>n;n++)e[n]=E.pluck(arguments,""+n);return e},E.object=function(t,e){if(null==t)return{};for(var n={},r=0,i=t.length;i>r;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},E.indexOf=function(t,e,n){if(null==t)return-1;var r=0,i=t.length;if(n){if("number"!=typeof n)return r=E.sortedIndex(t,e),t[r]===e?r:-1;r=0>n?Math.max(0,i+n):n}if(w&&t.indexOf===w)return t.indexOf(e,n);for(;i>r;r++)if(t[r]===e)return r;return-1},E.lastIndexOf=function(t,e,n){if(null==t)return-1;var r=null!=n;if(b&&t.lastIndexOf===b)return r?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var i=r?n:t.length;i--;)if(t[i]===e)return i;return-1},E.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=0,s=new Array(r);r>i;)s[i++]=t,t+=n;return s};var j=function(){};E.bind=function(t,e){var n,r;if(S&&t.bind===S)return S.apply(t,u.call(arguments,1));if(!E.isFunction(t))throw new TypeError;return n=u.call(arguments,2),r=function(){if(!(this instanceof r))return t.apply(e,n.concat(u.call(arguments)));j.prototype=t.prototype;var i=new j;j.prototype=null;var s=t.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}},E.partial=function(t){var e=u.call(arguments,1);return function(){return t.apply(this,e.concat(u.call(arguments)))}},E.bindAll=function(t){var e=u.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return C(e,function(e){t[e]=E.bind(t[e],t)}),t},E.memoize=function(t,e){var n={};return e||(e=E.identity),function(){var r=e.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=t.apply(this,arguments)}},E.delay=function(t,e){var n=u.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},E.defer=function(t){return E.delay.apply(E,[t,1].concat(u.call(arguments,1)))},E.throttle=function(t,e,n){var r,i,s,o=null,a=0;n||(n={});var c=function(){a=n.leading===!1?0:new Date,o=null,s=t.apply(r,i)};return function(){var u=new Date;a||n.leading!==!1||(a=u);var l=e-(u-a);return r=this,i=arguments,0>=l?(clearTimeout(o),o=null,a=u,s=t.apply(r,i)):o||n.trailing===!1||(o=setTimeout(c,l)),s}},E.debounce=function(t,e,n){var r,i,s,o,a;return function(){s=this,i=arguments,o=new Date;var c=function(){var u=new Date-o;e>u?r=setTimeout(c,e-u):(r=null,n||(a=t.apply(s,i)))},u=n&&!r;return r||(r=setTimeout(c,e)),u&&(a=t.apply(s,i)),a}},E.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},E.wrap=function(t,e){return function(){var n=[t];return c.apply(n,arguments),e.apply(this,n)}},E.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},E.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},E.keys=k||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)E.has(t,n)&&e.push(n);return e},E.values=function(t){for(var e=E.keys(t),n=e.length,r=new Array(n),i=0;n>i;i++)r[i]=t[e[i]];return r},E.pairs=function(t){for(var e=E.keys(t),n=e.length,r=new Array(n),i=0;n>i;i++)r[i]=[e[i],t[e[i]]];return r},E.invert=function(t){for(var e={},n=E.keys(t),r=0,i=n.length;i>r;r++)e[t[n[r]]]=n[r];return e},E.functions=E.methods=function(t){var e=[];for(var n in t)E.isFunction(t[n])&&e.push(n);return e.sort()},E.extend=function(t){return C(u.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},E.pick=function(t){var e={},n=l.apply(s,u.call(arguments,1));return C(n,function(n){n in t&&(e[n]=t[n])}),e},E.omit=function(t){var e={},n=l.apply(s,u.call(arguments,1));for(var r in t)E.contains(n,r)||(e[r]=t[r]);return e},E.defaults=function(t){return C(u.call(arguments,1),function(e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t},E.clone=function(t){return E.isObject(t)?E.isArray(t)?t.slice():E.extend({},t):t},E.tap=function(t,e){return e(t),t};var R=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof E&&(t=t._wrapped),e instanceof E&&(e=e._wrapped);var i=h.call(t);if(i!=h.call(e))return!1;switch(i){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=n.length;s--;)if(n[s]==t)return r[s]==e;var o=t.constructor,a=e.constructor;if(o!==a&&!(E.isFunction(o)&&o instanceof o&&E.isFunction(a)&&a instanceof a))return!1;n.push(t),r.push(e);var c=0,u=!0;if("[object Array]"==i){if(c=t.length,u=c==e.length)for(;c--&&(u=R(t[c],e[c],n,r)););}else{for(var l in t)if(E.has(t,l)&&(c++,!(u=E.has(e,l)&&R(t[l],e[l],n,r))))break;if(u){for(l in e)if(E.has(e,l)&&!c--)break;u=!c}}return n.pop(),r.pop(),u};E.isEqual=function(t,e){return R(t,e,[],[])},E.isEmpty=function(t){if(null==t)return!0;if(E.isArray(t)||E.isString(t))return 0===t.length;for(var e in t)if(E.has(t,e))return!1;return!0},E.isElement=function(t){return!(!t||1!==t.nodeType)},E.isArray=x||function(t){return"[object Array]"==h.call(t)},E.isObject=function(t){return t===Object(t)},C(["Arguments","Function","String","Number","Date","RegExp"],function(t){E["is"+t]=function(e){return h.call(e)=="[object "+t+"]"}}),E.isArguments(arguments)||(E.isArguments=function(t){return!(!t||!E.has(t,"callee"))}),"function"!=typeof/./&&(E.isFunction=function(t){return"function"==typeof t}),E.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},E.isNaN=function(t){return E.isNumber(t)&&t!=+t},E.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==h.call(t)},E.isNull=function(t){return null===t},E.isUndefined=function(t){return void 0===t},E.has=function(t,e){return f.call(t,e)},E.noConflict=function(){return t._=r,this},E.identity=function(t){return t},E.times=function(t,e,n){for(var r=Array(Math.max(0,t)),i=0;t>i;i++)r[i]=e.call(n,i);return r},E.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var N={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};N.unescape=E.invert(N.escape);var A={escape:new RegExp("["+E.keys(N.escape).join("")+"]","g"),unescape:new RegExp("("+E.keys(N.unescape).join("|")+")","g")};E.each(["escape","unescape"],function(t){E[t]=function(e){return null==e?"":(""+e).replace(A[t],function(e){return N[t][e]})}}),E.result=function(t,e){if(null==t)return void 0;var n=t[e];return E.isFunction(n)?n.call(t):n},E.mixin=function(t){C(E.functions(t),function(e){var n=E[e]=t[e];E.prototype[e]=function(){var t=[this._wrapped];return c.apply(t,arguments),D.call(this,n.apply(E,t))}})};var q=0;E.uniqueId=function(t){var e=++q+"";return t?t+e:e},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;E.template=function(t,e,n){var r;n=E.defaults({},n,E.templateSettings);var i=new RegExp([(n.escape||I).source,(n.interpolate||I).source,(n.evaluate||I).source].join("|")+"|$","g"),s=0,o="__p+='";t.replace(i,function(e,n,r,i,a){return o+=t.slice(s,a).replace(M,function(t){return"\\"+L[t]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=a+e.length,e}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(e)return r(e,E);var c=function(t){return r.call(this,t,E)};return c.source="function("+(n.variable||"obj")+"){\n"+o+"}",c},E.chain=function(t){return E(t).chain()};var D=function(t){return this._chain?E(t).chain():t};E.mixin(E),C(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];E.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],D.call(this,n)}}),C(["concat","join","slice"],function(t){var e=s[t];E.prototype[t]=function(){return D.call(this,e.apply(this._wrapped,arguments))}}),E.extend(E.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}],21:[function(t,e){var n={article_type:{doc_count_error_upper_bound:0,sum_other_doc_count:0,buckets:[{key:"Research article",doc_count:838},{key:"Insight",doc_count:186},{key:"Correction",doc_count:44},{key:"Feature article",doc_count:41},{key:"Short report",doc_count:32},{key:"Editorial",doc_count:11},{key:"Research advance",doc_count:13},{key:"Registered report",doc_count:8},{key:"Feature Article",doc_count:1}]},subjects:{doc_count_error_upper_bound:0,sum_other_doc_count:0,buckets:[{key:"Cell biology",doc_count:286},{key:"Neuroscience",doc_count:251},{key:"Biophysics and structural biology",doc_count:215},{key:"Biochemistry",doc_count:183},{key:"Developmental biology and stem cells",doc_count:162},{key:"Genomics and evolutionary biology",doc_count:152},{key:"Genes and chromosomes",doc_count:123},{key:"Microbiology and infectious disease",doc_count:124},{key:"Human biology and medicine",doc_count:88},{key:"Immunology",doc_count:62},{key:"Plant biology",doc_count:51},{key:"Ecology",doc_count:33},{key:"Epidemiology and global health",doc_count:21},{key:"Computational and systems biology",doc_count:2}]},organisms:{doc_count_error_upper_bound:0,sum_other_doc_count:246,buckets:[{key:"mouse",doc_count:195},{key:"human",doc_count:182},{key:"Mouse",doc_count:128},{key:"Human",doc_count:114},{key:"other",doc_count:116},{key:"D. melanogaster",doc_count:113},{key:"S. cerevisiae",doc_count:98},{key:"E. coli",doc_count:81},{key:"Other",doc_count:51},{key:"Arabidopsis",doc_count:39}]},authors:{doc_count_error_upper_bound:4,sum_other_doc_count:6627,buckets:[{key:"Randy Schekman",doc_count:14},{key:"Eve Marder",doc_count:9},{key:"Detlef Weigel",doc_count:9},{key:"Bill S Hansson",doc_count:7},{key:"Chris P Ponting",doc_count:6},{key:"Fiona M Watt",doc_count:5},{key:"Peter Walter",doc_count:6},{key:"Alma L Burlingame",doc_count:4},{key:"Irene Farabella",doc_count:4},{key:"Maya Topf",doc_count:4}]}};e.exports=n},{}],22:[function(t,e){var n=["synaptic plasticity","STDP","visual cortex","circuits","in vivo","spiking patterns","mouse","Circadian rhythms","transcription","nascent RNA","high-throughput sequencing","RNA processing","post-transcriptional regulation","Methanothermobacter marburgensis","cryo-electron microscopy","methanogenesis","hydrogenase"];e.exports=n},{}],23:[function(t,e){"use strict";var n=t("underscore"),r=(t("substance-util"),t("substance-application").Controller),i=t("./browser_view"),s=t("./search_query"),o=t("./search_result"),a=(t("./available_facets"),t("./available_keywords")),c={searchStr:"",filters:{}},u=function(t,e){r.call(this,t),this.config=e,this.searchQuery=new s(c),this.createView(),this.searchQuery.on("query:changed",n.bind(this.startSearch,this))};u.Prototype=function(){this.initialize=function(t,e){e(null)},this.DEFAULT_STATE={id:"main"},this.startSearch=function(){ga("send","event","search:"+this.searchQuery.searchStr,"search","search"),this.switchState({id:"main",searchQuery:this.searchQuery.toJSON()})},this.getSuggestions=function(t){var e=[];return n.each(a,function(n){n.toLowerCase().match(t.toLowerCase())&&e.push({value:n.replace(t,"<b>"+t+"</b>"),rawValue:n})}),e},this.createView=function(){return this.view||(this.view=new i(this)),this.view},this.transition=function(t,e){if(console.log("BrowserController.transition(%s -> %s)",this.state.id,t.id),"main"!==t.id)return console.log("state not explicitly handled",this.state,t),e(null);if("uninitialized"===this.state.id){console.log("setting initial query",t.searchQuery);var r;t.searchQuery?r=JSON.parse(JSON.stringify(t.searchQuery)):(r=c,t.searchQuery=JSON.parse(JSON.stringify(r))),this.searchQuery.setQuery(r)}return n.isEqual(t.searchQuery,this.state.searchQuery)?(console.log("no state change detected, skipping",this.state,t),e(null,{skip:!0})):void this.loadSearchResult(t,e)},this.loadPreview=function(t,e,r){var i=this;$.ajax({url:i.config.api_url+"/search/document?documentId="+encodeURIComponent(t)+"&searchString="+encodeURIComponent(e),dataType:"json",success:function(s){var o=n.last(t.split("."));s.document.id=t,s.document.url="http://lens.elifesciences.org/"+o,s.document.pdf_url="http://cdn.elifesciences.org/elife-articles/"+o+"/pdf/elife"+o+".pdf",s.searchStr=e,i.previewData=s,r(null)},error:function(t){console.error(t.responseText),r(t.responseText)}})},this.loadSearchResult=function(t,e){this.view.showLoading();var r=t.searchQuery,i=(t.documentId,this);$.ajax({url:this.config.api_url+"/search?searchQuery="+encodeURIComponent(JSON.stringify(r)),dataType:"json",success:function(t){console.log("search result:",t),n.each(t.hits.hits,function(t){var e=n.last(t._id.split("."));t._source.url="http://lens.elifesciences.org/"+e},this),i.searchResult=new o({searchQuery:i.searchQuery,result:t},{}),i.previewData=null,e(null)},error:function(t){console.error(t.responseText),e(t.responseText)}})},this.afterTransition=function(t){var e=this.state;this.view.afterTransition(t,e)}},u.Prototype.prototype=r.prototype,u.prototype=new u.Prototype,u.Controller=u,e.exports=u},{"./available_facets":21,"./available_keywords":22,"./browser_view":24,"./search_query":28,"./search_result":29,"substance-application":3,"substance-util":12,underscore:20}],24:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-application").View,i=t("substance-application").$$,s=t("./searchbar_view"),o=t("./preview_view"),a=t("./facets_view"),c={"Research article":"research-article","Feature article":"feature-article",Insight:"insight",Correction:"correction","Short report":"short-report",Editorial:"editorial","Research advance":"research-advance","Registered report":"registered-report"},u=function(t){r.call(this),this.controller=t,this.$el.attr({id:"container"}),this.searchbarView=new s(this.controller.searchQuery,{getSuggestions:n.bind(this.controller.getSuggestions,this.controller)}),this.facetsEl=i("#facets"),this.documentsEl=i("#documents"),this.documentsEl.appendChild(i(".no-result",{text:"Loading documents ..."})),this.previewEl=i("#preview"),this.panelWrapperEl=i(".panel-wrapper"),this.panelWrapperEl.appendChild(this.facetsEl),this.panelWrapperEl.appendChild(this.documentsEl),this.panelWrapperEl.appendChild(this.previewEl),this.progressbarEl=i(".progress-bar",{html:'<div class="progress loading"></div>'}),this.$el.on("click",".available-facets .value",n.bind(this.toggleFilter,this)),this.$el.on("click",".document .toggle-preview",n.bind(this.togglePreview,this)),this.$el.on("click",".show-more",n.bind(this._preventDefault,this)),this.controller.searchQuery.on("query:changed",n.bind(this.renderFacets,this))};u.Prototype=function(){this._preventDefault=function(t){t.preventDefault()},this.togglePreview=function(t){t.preventDefault();var e=this.controller.searchQuery,n=$(t.currentTarget).parent(),r=n.attr("data-id"),i=this;ga("send","event","preview","click","preview");var s=n.find(".preview");s.length>0?s.toggle():(this.showLoading(),this.controller.loadPreview(r,e.searchStr,function(){i.renderPreview(),i.hideLoading()}))},this.toggleFilter=function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-facet"),n=$(t.currentTarget).attr("data-value");ga("send","event","filter:"+e+":"+n,"click","filters"),this.controller.searchQuery.toggleFilter(e,n)},this.showLoading=function(){$(".progress-bar").removeClass("done loading").show(),n.delay(function(){$(".progress-bar").addClass("loading")},10)},this.hideLoading=function(){$(this.loadingEl).hide(),$(".progress-bar").addClass("done"),n.delay(function(){$(".progress-bar").hide()},1e3)},this.afterTransition=function(t,e){"main"===e.id&&(n.isEqual(e.searchQuery,t.searchQuery)||(this.renderSearchResult(),this.hideLoading()))},this.renderPreview=function(){var t=this.controller.previewData,e=t.document.id;if(this.controller.previewData){var n=new o(t);this.$(".document").each(function(){e===this.dataset.id&&this.appendChild(n.render().el)})}},this.renderFacets=function(){this.facetsView=new a(this.controller.searchResult.getFacets()),this.facetsEl.innerHTML="",this.facetsEl.appendChild(this.facetsView.render().el)},this.renderSearchResult=function(){var t=this.controller.state.searchQuery.searchStr,e=this.controller.state.searchQuery.filters;if(this.controller.searchResult){this.documentsEl.innerHTML="";var r=this.controller.searchResult.getDocuments(),s=this.controller.searchResult.getSearchMetrics();r.length>0?(this.documentsEl.appendChild(i(".no-result",{text:s.hits+" articles found"})),n.each(r,function(r){var s=i(".filters");n.each(e,function(t,e){var o=r[e];n.isArray(o)||(o=[o]),n.each(t,function(t){if(n.include(o,t)){var e=i(".filter",{text:t});s.appendChild(e)}})});var a=[i(".meta-info",{children:[i(".article-type."+c[r.article_type],{html:r.article_type+" "}),i(".doi",{html:r.doi+" "}),i(".published-on",{text:"published on "+new Date(r.published_on).toDateString()})]}),i(".title",{children:[i("a",{href:r.url,target:"_blank",html:r.title})]})];r.intro&&a.push(i(".intro",{html:r.intro})),a.push(i(".authors",{html:r.authors_string})),s.childNodes.length>0&&a.push(s);var u=i(".document",{"data-id":r.id,children:a});if(r.fragments){var l=new o({document:r,fragments:r.fragments,searchStr:t});u.appendChild(l.render().el)}this.documentsEl.appendChild(u)},this)):this.documentsEl.appendChild(i(".no-result",{text:"Your search did not match any documents"})),this.renderFacets()}},this.render=function(){return this.el.innerHTML="",this.el.appendChild(this.searchbarView.render().el),this.el.appendChild(this.panelWrapperEl),this.el.appendChild(this.progressbarEl),this},this.dispose=function(){this.stopListening(),this.mainView&&this.mainView.dispose()}},u.Prototype.prototype=r.prototype,u.prototype=new u.Prototype,e.exports=u},{"./facets_view":25,"./preview_view":27,"./searchbar_view":30,"substance-application":3,underscore:20}],25:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-application").View,i=t("substance-application").$$,s=function(t){r.call(this),this.facets=t,this.$el.addClass("facets")};s.Prototype=function(){this.render=function(){return this.el.innerHTML="",this.renderFacets(),this},this.renderFacets=function(){this.availableFacets=i(".available-facets"),n.each(this.facets,function(t){var e=i(".facet."+t.property);e.appendChild(i(".facet-name",{text:t.name}));var r=i(".facet-values");n.each(t.entries,function(e){var n;n=e.selected?"fa-check-square-o":"fa-square-o";var s=e.name,o=e.frequency,a=e.scoped_frequency,c=100*a/o,u=i("a.value"+(e.selected?".selected":"")+(0==a?".not-included":""),{href:"#","data-facet":t.property,"data-value":e.name,children:[i(".icon",{html:'<i class="fa '+n+'"></i>'}),i(".label",{html:s}),i(".frequency",{children:[i(".scoped-frequency-label",{text:e.scoped_frequency}),i(".total-frequency-label",{text:e.frequency}),i(".total-frequency-bar"),i(".scoped-frequency-bar",{style:"width: "+c+"%"})]})]});r.appendChild(u)},this),e.appendChild(r),this.availableFacets.appendChild(e)},this),this.el.appendChild(this.availableFacets)},this.dispose=function(){this.stopListening()}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,e.exports=s},{"substance-application":3,underscore:20}],26:[function(t,e){"use strict";var n=(t("underscore"),t("substance-application")),r=t("./browser_controller"),i=t("substance-application").DefaultRouter,s=t("../config"),o=function(){n.call(this),this.controller=new r(this,s);var t=new i(this);this.setRouter(t)};o.Prototype=function(){var t=n.prototype;this.start=function(e){t.start.call(this,e),this.el.appendChild(this.controller.view.render().el),window.location.hash||this.switchState([{id:"main"}],{updateRoute:!0,replace:!0})}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,e.exports=o},{"../config":2,"./browser_controller":23,"substance-application":3,underscore:20}],27:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-application").View,i=t("substance-application").$$,s=function(t){r.call(this),this.model=t,this.$el.addClass("preview")};s.Prototype=function(){this.render=function(){return this.renderPreview(),this},this.renderPreview=function(){this.el.innerHTML="";var t=i(".fragments");n.each(this.model.fragments,function(e){t.appendChild(i(".fragment",{children:[i(".separator"),i(".content",{html:e.content})]}))},this),this.el.appendChild(t)},this.dispose=function(){this.stopListening()}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,e.exports=s},{"substance-application":3,underscore:20}],28:[function(t,e){var n=t("underscore"),r=t("substance-util"),i=function(t){this.searchStr=t.searchStr,this.filters=t.filters};i.Prototype=function(){this.addFilter=function(t,e){this.filters[t]||(this.filters[t]=[]),this.filters[t].push(e),this.trigger("query:changed")},this.removeFilter=function(t,e){var r=this.filters[t];this.filters[t]=n.without(r,e),0===r.length&&delete this.filters[t],this.trigger("query:changed")},this.clearFilters=function(){this.filters={},this.trigger("query:changed")},this.hasFilter=function(t,e){var n=this.filters[t];return n?n.indexOf(e)>=0:!1},this.toggleFilter=function(t,e){this.hasFilter(t,e)?this.removeFilter(t,e):this.addFilter(t,e)},this.removeLastFilter=function(){console.log("TODO: Implement.")},this.updateSearchStr=function(t){this.searchStr=t,this.trigger("query:changed")},this.setQuery=function(t){this.searchStr=t.searchStr,this.filters=t.filters},this.toJSON=function(){return{searchStr:this.searchStr,filters:this.filters}}},i.Prototype.prototype=r.Events,i.prototype=new i.Prototype,e.exports=i},{"substance-util":12,underscore:20}],29:[function(t,e){var n=t("underscore"),r=t("./available_facets"),i={subjects:"Subjects",article_type:"Article Type",organisms:"Organisms",authors:"Top Authors"},s=function(t){this.rawResult=t.result,this.searchQuery=t.searchQuery};s.Prototype=function(){this.getSearchMetrics=function(){return{hits:this.rawResult.hits.total}},this.getDocuments=function(){var t=[];return n.each(this.rawResult.hits.hits,function(e){var r=JSON.parse(JSON.stringify(e._source));t.push(n.extend(r,{id:e._id,fragments:e.fragments,_score:e._score,title:e.highlight&&e.highlight.title?e.highlight.title[0]:e._source.title,authors_string:e.highlight&&e.highlight.authors_string?e.highlight.authors_string[0]:e._source.authors_string,intro:e.highlight&&e.highlight.intro?e.highlight.intro[0]:e._source.intro,doi:e.highlight&&e.highlight.doi?e.highlight.doi[0]:e._source.doi}))}),t},this.getScopedFrequency=function(t,e){var t=this.rawResult.aggregations[t];if(!t)return"0";var r=n.select(t.buckets,function(t){return t.key===e});return r.length>0?r[0].doc_count:"0"},this.getFacets=function(){var t=[],e=this,s=this.rawResult.aggregations;return n.each(i,function(i,o){var a=[];r[o]?n.each(r[o].buckets,function(t){a.push({name:t.key,frequency:t.doc_count,scoped_frequency:e.getScopedFrequency(o,t.key),selected:e.isSelected(o,t.key)})}):"authors"===o&&n.each(s.authors.buckets,function(t){a.push({name:t.key,frequency:t.doc_count,scoped_frequency:e.getScopedFrequency(o,t.key),selected:e.isSelected(o,t.key)})}),t.push({name:i,property:o,entries:a})}),t},this.isSelected=function(t,e){var n=this.searchQuery.filters[t];return n?n.indexOf(e)>=0:!1}},s.prototype=new s.Prototype,e.exports=s},{"./available_facets":21,underscore:20}],30:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-application").View,i=t("substance-application").$$,s={subjects:"fa-tags",article_type:"fa-align-left",organisms:"fa-leaf"},o=function(t,e){r.call(this),this.searchQuery=t,this.options=e,this.$el.addClass("searchbar"),this.searchFieldEl=i(".search-field"),this.searchFieldFilters=i(".search-field-filters"),this.searchFieldEl.appendChild(this.searchFieldFilters),this.searchFieldInputEl=i("input.search-field-input",{type:"text",placeholder:"Enter search term"}),this.searchFieldEl.appendChild(this.searchFieldInputEl),this.searchButton=i("a.search-button",{href:"#",text:"Search"}),this.searchFieldEl.appendChild(this.searchButton),this.searchFieldSuggestionsEl=i(".search-field-suggestions"),$(this.searchFieldSuggestionsEl).hide(),this.searchFieldEl.appendChild(this.searchFieldSuggestionsEl),this.el.appendChild(this.searchFieldEl),$(this.searchFieldInputEl).keyup(n.bind(this._updateSuggestions,this)),$(this.searchFieldInputEl).keydown(n.bind(this._interpretKey,this)),$(this.searchFieldInputEl).blur(n.bind(this._hideSuggestions,this)),$(this.el).click(n.bind(this._hideSuggestions,this)),this.$el.on("click",".search-field-suggestion",n.bind(this._useKeyword,this)),this.$el.on("click",".remove-filter",n.bind(this._removeFilter,this)),this.$el.on("click",".clear-filters",n.bind(this._clearFilters,this)),$(this.searchFieldInputEl).change(n.bind(this._updateSearchStr,this)),this.searchQuery.on("query:changed",n.bind(this.updateView,this))};o.Prototype=function(){this._updateSearchStr=function(t){var e=$(this.searchFieldInputEl).val();this.searchQuery.updateSearchStr(e),t.preventDefault(),console.log("updating searchstr")},this._removeFilter=function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-facet"),n=$(t.currentTarget).attr("data-value");this.searchQuery.removeFilter(e,n)},this._clearFilters=function(t){t.preventDefault(),this.searchQuery.clearFilters()},this._interpretKey=function(t){$(t.currentTarget).val();40===t.keyCode?(this.nextSuggestion(),t.preventDefault()):38===t.keyCode?(this.prevSuggestion(),t.preventDefault()):13===t.keyCode&&this.chooseSuggestion()},this._updateSuggestions=function(t){var e=$(t.currentTarget).val();n.include([40,38,13],t.keyCode)||this.renderSuggestions(e)},this._hideSuggestions=function(){var t=this.searchFieldSuggestionsEl;n.delay(function(){$(t).hide()},200,this)},this._useKeyword=function(t){var e=$(t.currentTarget),n=e.attr("data-value");this._hideSuggestions(),$(this.searchFieldInputEl).val(n).focus(),this._updateSearchStr(t),t.preventDefault()},this.chooseSuggestion=function(){var t=this.$(".search-field-suggestion.active");t.length>0?t.trigger("click"):this._hideSuggestions()},this.render=function(){return this.updateView(),this},this.renderFilters=function(){this.searchFieldFilters.innerHTML="";var t=0;if(n.each(this.searchQuery.filters,function(e){n.each(e,function(e){var n=i(".search-field-filter",{html:e});3>t&&this.searchFieldFilters.appendChild(n),t+=1},this)},this),t>3){var e=i(".search-field-filter",{text:"and "+(t-3)+" more"});this.searchFieldFilters.appendChild(e)}if(t>0){var r=i(".search-field-filter",{children:[i("a.clear-filters",{href:"#",text:"Clear Filters"})]});this.searchFieldFilters.appendChild(r)}},this.updateView=function(){console.log("query changed... updating the view"),$(this.searchFieldInputEl).val(this.searchQuery.searchStr),this.renderFilters()},this.prevSuggestion=function(){var t=this.searchFieldSuggestionsEl.childNodes;if(t.length>0){var e=this.$(".search-field-suggestion.active");0===e.length?$(n.last(t)).addClass("active"):(e.removeClass("active"),e.prev().addClass("active"))}},this.nextSuggestion=function(){var t=this.searchFieldSuggestionsEl.childNodes;if(t.length>0){var e=this.$(".search-field-suggestion.active");0===e.length?$(t[0]).addClass("active"):(e.removeClass("active"),e.next().addClass("active"))}},this.renderSuggestions=function(t){var e=this.options.getSuggestions(t);return 0===e.length?void $(this.searchFieldSuggestionsEl).hide():(this.searchFieldSuggestionsEl.innerHTML="",n.each(e,function(t){var e=i("a.search-field-suggestion",{html:'<i class="fa '+s[t.facet]+'"></i> '+t.value,href:"#","data-value":t.rawValue,"data-facet":t.facet});this.searchFieldSuggestionsEl.appendChild(e)},this),void $(this.searchFieldSuggestionsEl).show())},this.dispose=function(){this.stopListening()}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,e.exports=o},{"substance-application":3,underscore:20}],31:[function(){},{}]},{},[1]);