!function t(e,r,n){function i(o,a){if(!r[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[o]={exports:{}};e[o][0].call(l.exports,function(t){var r=e[o][1][t];return i(r?r:t)},l,l.exports,t,e,r,n)}return r[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t){window.LensBrowser=t("./src/lens_browser")},{"./src/lens_browser":25}],2:[function(t,e){"use strict";var r=t("./src/application");r.View=t("./src/view"),r.Controller=t("./src/controller"),"undefined"!=typeof window&&(r.Router=t("./src/router"),r.DefaultRouter=t("./src/default_router"),r.ElementRenderer=t("./src/renderers/element_renderer"),r.$$=r.ElementRenderer.$$),e.exports=r},{"./src/application":3,"./src/controller":4,"./src/default_router":5,"./src/renderers/element_renderer":6,"./src/router":7,"./src/view":8}],3:[function(t,e){"use strict";var r=t("./view"),n=t("substance-util"),i=t("underscore"),s=function(t){r.call(this),this.config=t||{},this.__controller__=null};s.Prototype=function(){this.setRouter=function(t){this.router=t},this.start=function(t){var e=window.$;t=t||{},t.el?(this.el=t.el,this.$el=e(this.el)):(this.$el=e("body"),this.el=this.$el[0]),this.initialize&&this.initialize(),this.render&&this.render(),this.router&&this.router.start()};var t={updateRoute:!0,replace:!1};this.switchState=function(e,r,s){e=JSON.parse(JSON.stringify(e));var o=this;r=i.extend({},t,r||{});var a=this.getState();this.controller.__switchState__(e,r,function(t){if(t)return void(s?s(t):(console.error(t.message),n.printStackTrace(t)));if(r.updateRoute&&o.updateRoute(r),o.afterTransition)try{o.afterTransition(e,a)}catch(i){return void(s?s(i):(console.error(i.message),n.printStackTrace(i)))}s&&s(null)})},this.stateFromFragment=function(t){function e(t){for(var e=[],r=0;r<t.length;r++)e.push({id:t[r]});return e}var r,n,i,s=t.split(";"),o=[];for(n=0;n<s.length;n++){i=s[n].split("=");var a=i[0],c=i[1];if(a&&void 0!==c)if("state"===a){var u=c.split(".");r=e(u)}else i=a.split("."),o.push({state:i[0],key:i[1],value:c})}for(n=0;n<o.length;n++){var l=o[n],h=r[l.state],f=l.value;f=window.decodeURIComponent(f);var c=JSON.parse(f);h[l.key]=c}return r},this.getState=function(){if(!this.controller.state)return null;for(var t=[],e=this.controller;e;)t.push(e.state),e=e.childController;return t},this.updateRoute=function(t){if(!this.router&&!this.config.headless)throw new Error("Application.updateRoute(): application has no router.");t=t||{};for(var e=this.getState(),r=[],n=[],i=0;i<e.length;i++){var s=e[i];if(s){var o=s.id||"default";r.push(o);for(var a in s)if("id"!==a&&"__id__"!==a&&"options"!==a){var c=JSON.stringify(s[a]),u=window.encodeURIComponent(c);n.push(i+"."+a+"="+u)}}}var l="state="+r.join(".")+";"+n.join(";");this.router.navigate(l,{trigger:!1,replace:t.replace})},this.stateChanged=function(t,e,r){r.updateRoute&&this.updateRoute(r)},this.sendError=function(t){throw t}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,Object.defineProperty(s.prototype,"controller",{set:function(t){t.setChangeListener(this),this.__controller__=t},get:function(){return this.__controller__}}),e.exports=s},{"./view":8,"substance-util":11,underscore:19}],4:[function(t,e){"use strict";var r=t("substance-util"),n=t("underscore"),i=function(){this.changeListener=null,this.state={id:"uninitialized"},this.__childController__=null,this.__parentController__=null};i.Prototype=function(){this.intitialize=function(){},this.dispose=function(){this.__childController__&&this.__childController__.dispose(),this.__childController__=null,this.state={id:"uninitialized"}},this.transition=function(t,e){e(null)},this.switchState=function(t,e,i){t=JSON.parse(JSON.stringify(t)),!i&&n.isFunction(e)&&(i=e);var s=this;1===arguments.length&&n.isFunction(e)&&(i=e,e={}),e=e||{updateRoute:!0,replace:!1},i=i||function(n){if(n)throw console.error("Error during switch state",t,e),r.printStackTrace(n),new Error(n)};var o=this.state;this.__switchState__(t,e,function(t){return t?i(t):(s.changeListener&&s.changeListener.stateChanged(this,o,e),void i(null))})},this.__switchState__=function(t,e,r){var i=this;r=r||function(t){if(t)throw new Error(t)},n.isArray(t)||(t=[t]);var s=t.shift();s.options=e||{};var o,a=function(){if(!o){var t=i.state;i.state=s,i.afterTransition(t),i.state.options={}}r(null)},c=function(){try{i.transition(s,function(e,s){if(e)return r(e);if(n.isBoolean(s)?o=s:s&&(o=s.skip),i.childController)if(t.length>0)i.childController.__switchState__(t,s,function(t){return t?r(t):void a()});else{if(!i.childController.DEFAULT_STATE)throw new Error("Unsufficient state data provided! Child controller needs a transition!");i.childController.__switchState__(i.childController.DEFAULT_STATE,s,function(t){return t?r(t):void a()})}else a()})}catch(e){r(e)}};this.state?c():this.initialize(s,function(t){return t?r(t):(i.state={id:"initialized"},void c())})},this.afterTransition=function(){},this.setChildController=function(t,e){e=e||{},this.__childController__&&this.__childController__.state&&!e.nowarn&&console.error("The child controller has not been disposed. Call 'disposeChildController()' first."),t&&(this.changeListener?t.changeListener=this.changeListener:console.error("This controller does not have a changeListener attached, so the child controller will not trigger corresponding application state changes."),t.__parentController__=this,this.__childController__=t)},this.disposeChildController=function(){this.__childController__&&(this.__childController__.dispose(),this.__childController__=null)},this.setChangeListener=function(t){this.changeListener=t},this.sendError=function(t){this.__parentController__&&this.__parentController__.sendError(t)}},i.Prototype.prototype=r.Events,i.prototype=new i.Prototype,i.State=function(t){if(n.isString(t))this.__id__=t;else{var e=arguments[0];this.__id__=e.id,n.each(e,function(t,e){"id"!==e&&(this[e]=t)},this)}},Object.defineProperty(i.State.prototype,"id",{set:function(){throw new Error("Property 'id' is immutable")},get:function(){return this.__id__}}),Object.defineProperty(i.prototype,"childController",{set:function(t){this.setChildController(t)},get:function(){return this.__childController__}}),e.exports=i},{"substance-util":11,underscore:19}],5:[function(t,e){"use strict";var r=t("underscore"),n=t("./router"),i=function(t){n.call(this),this.app=t,r.each(i.routes,function(t){this[t.command]?this.route(t.route,t.name,r.bind(this[t.command],this)):console.error("Unknown route handler: ",t.command)},this),this.route(/^state=.*$/,"state",r.bind(this.openState,this))};i.Prototype=function(){this.start=function(){n.history.start()};var t={updateRoute:!1,replace:!1};this.openState=function(){var e=n.history.getFragment(),r=this.app.stateFromFragment(e);console.log("state change triggerd by router",JSON.stringify(r)),this.app.switchState(r,t)},this.navigate=function(t,e){n.history.navigate(t,e)}},i.Prototype.prototype=n.prototype,i.prototype=new i.Prototype,e.exports=i},{"./router":7,underscore:19}],6:[function(t,e){"use strict";var r=t("substance-util"),n=t("substance-regexp"),i=function(t){return this.attributes=t,this.tagName=t.tag,this.children=t.children||[],this.text=t.text||"",this.html=t.html,delete t.children,delete t.text,delete t.html,delete t.tag,this.render()};i.Prototype=function(){this.render=function(){var t=window.document.createElement(this.tagName);this.html?t.innerHTML=this.html:t.textContent=this.text;for(var e in this.attributes){var r=this.attributes[e];t.setAttribute(e,r)}for(var n=0;n<this.children.length;n++){var i=this.children[n];t.appendChild(i)}return this.el=t,t}};var s=function(t,e){e=e||{};var r=/^([a-zA-Z0-9]*)/.exec(t);e.tag=r&&r[1]?r[1]:"div";var s=/#([a-zA-Z0-9_]*)/.exec(t);s&&s[1]&&(e.id=s[1]);var o=new n(/\.([a-zA-Z0-9_-]*)/g);return e.class||(e.class=o.match(t).map(function(t){return t.match[1]}).join(" ")),new i(e)};i.$$=s,i.Prototype.prototype=r.Events,i.prototype=new i.Prototype,e.exports=i},{"substance-regexp":9,"substance-util":11}],7:[function(t,e){"use strict";var r,n=t("substance-util"),i=t("underscore");"undefined"!=typeof window?r=window.$:(console.error("FIXME: require router.js only when you are in a window context."),r=null);var s=function(t){t=t||{},t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},o=/\((.*?)\)/g,a=/(\(\?)?:\w+/g,c=/\*\w+/g,u=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(s.prototype,n.Events,{initialize:function(){},route:function(t,e,r){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(e)&&(r=e,e=""),r||(r=this[e]);var n=this;return s.history.route(t,function(i){var o=n._extractParameters(t,i);r&&r.apply(n,o),n.trigger.apply(n,["route:"+e].concat(o)),n.trigger("route",e,o),s.history.trigger("route",n,e,o)}),this},navigate:function(t,e){return s.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!==(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(u,"\\$&").replace(o,"(?:$1)?").replace(a,function(t,e){return e?t:"([^/]+)"}).replace(c,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var r=t.exec(e).slice(1);return i.map(r,function(t){return t?decodeURIComponent(t):null})}});var l=s.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},h=/^[#\/]|\s+$/g,f=/^\/+|\/+$/g,p=/msie [\w.]+/,d=/\/$/;l.started=!1,i.extend(l.prototype,n.Events,{interval:50,getHash:function(t){var e=(t||window).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null===t||void 0===t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var r=this.root.replace(d,"");t.indexOf(r)||(t=t.substr(r.length))}else t=this.getHash();return t.replace(h,"")},start:function(t){if(l.started)throw new Error("Router.history has already been started");l.started=!0,this.options=i.extend({},{root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment(),n=window.document.documentMode,s=p.exec(window.navigator.userAgent.toLowerCase())&&(!n||7>=n);this.root=("/"+this.root+"/").replace(f,"/"),s&&this._wantsHashChange&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?r(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?r(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e;var o=this.location,a=o.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&o.hash&&(this.fragment=this.getHash().replace(h,""),this.history.replaceState({},window.document.title,this.root+this.fragment+o.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){r(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),l.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t),r=i.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return r},navigate:function(t,e){if(!l.started)return!1;if(e&&e!==!0||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){this.fragment=t;var r=this.root+t;if(this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},window.document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}e.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,r){if(r){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),s.history=new l,e.exports=s},{"substance-util":11,underscore:19}],8:[function(t,e){"use strict";var r=t("substance-util"),n=function(){this.$el=window.$("<div/>"),this.el=this.$el[0],this.dispatchDOMEvents()};n.Prototype=function(){this.dispose=function(){this.stopListening()},this.$=function(t){return this.$el.find(t)},this.dispatchDOMEvents=function(){function t(t){var e=/(\w+)\((.*)\)/.exec(t);if(!e)throw new Error("Invalid click handler '"+t+"'");return{method:e[1],args:e[2].split(",")}}var e=this;this.$el.delegate("[sbs-click]","click",function(r){var n=t(window.$(r.currentTarget).attr("sbs-click")),i=e[n.method];return i?(i.apply(e,n.args),!1):void 0})},this.updateTitle=function(t){window.document.title=t,window.history.replaceState({},window.document.title,window.location.href)}},n.Prototype.prototype=r.Events,n.prototype=new n.Prototype,e.exports=n},{"substance-util":11}],9:[function(t,e){"use strict";e.exports=t("./src/regexp")},{"./src/regexp":10}],10:[function(t,e){"use strict";var r=function(t){this.index=t.index,this.match=[];for(var e=0;e<t.length;e++)this.match.push(t[e])};r.Prototype=function(){this.captures=function(){return this.match.slice(1)},this.toString=function(){return this.match[0]}},r.prototype=new r.Prototype;var n=function(t){this.exp=t};n.Prototype=function(){this.match=function(t){if(void 0===t)throw new Error("No string given");if(this.exp.global){var e,n=[];for(this.exp.compile(this.exp);null!==(e=this.exp.exec(t));)n.push(new r(e));return n}return this.exp.exec(t)}},n.prototype=new n.Prototype,n.Match=r,e.exports=n},{}],11:[function(t,e){"use strict";var r=t("./src/util");r.async=t("./src/async"),r.errors=t("./src/errors"),r.html=t("./src/html"),r.dom=t("./src/dom"),r.RegExp=t("./src/regexp"),r.Fragmenter=t("./src/fragmenter"),e.exports=r},{"./src/async":12,"./src/dom":13,"./src/errors":14,"./src/fragmenter":15,"./src/html":16,"./src/regexp":17,"./src/util":18}],12:[function(t,e){"use strict";function r(t,e){function r(t){var e=a[c];if(!e)return l.length>0?n(new Error("Multiple errors occurred.",t)):n(null,t);var o=i.once(function(t,e){if(t){if(u)return n(t,null);l.push(t)}c+=1,r(e)});try{0===e.length?(e(),o(null,t)):1===e.length?e(o):e(t,o)}catch(h){console.log("util.async caught error:",h),s.printStackTrace(h),n(h)}}var n=t["finally"]||function(t,r){e(t,r)};n=i.once(n);var o=t.data||{},a=t.functions;if(!i.isFunction(e))return e("Illegal arguments: a callback function must be provided");var c=0,u=void 0===t.stopOnError?!0:t.stopOnError,l=[];r(o)}function n(t){return function(e,n){function s(t,e){return function(r,n){2===h.length?h(t,n):3===h.length?h(t,e,n):h(t,e,r,n)}}function o(t,e){return function(r,n){2===h.length?h(t,n):3===h.length?h(t,e,n):h(t,e,r,n)}}var a=t.selector?t.selector(e):t.items,c=t["finally"]||function(t,e){n(t,e)};if(c=i.once(c),!a)return c(null,e);var u=i.isArray(a);t.before&&t.before(e);var l=[],h=t.iterator;if(u)for(var f=0;f<a.length;f++)l.push(s(a[f],f));else for(var p in a)l.push(o(a[p],p));var d={functions:l,data:e,"finally":c,stopOnError:t.stopOnError};r(d,n)}}var i=t("underscore"),s=t("./util.js"),o={};o.sequential=function(t,e){i.isArray(t)&&(t={functions:t}),r(t,e)},o.iterator=function(t,e){var r;return r=1==arguments.length?t:{items:t,iterator:e},n(r)},o.each=function(t,e){var r=n(t);r(null,e)},e.exports=o},{"./util.js":18,underscore:19}],13:[function(t,e){"use strict";var r=t("underscore"),n={};n.ChildNodeIterator=function(t){this.nodes=r.isArray(t)?t:t.childNodes,this.length=this.nodes.length,this.pos=-1},n.ChildNodeIterator.prototype={hasNext:function(){return this.pos<this.length-1},next:function(){return this.pos+=1,this.nodes[this.pos]},back:function(){return this.pos>=0&&(this.pos-=1),this}},n.getChildren=function(t){if(void 0!==t.children)return t.children;for(var e=[],r=t.firstElementChild;r;)e.push(r),r=r.nextElementSibling;return e},n.getNodeType=function(t){return t.nodeType===window.Node.TEXT_NODE?"text":t.nodeType===window.Node.COMMENT_NODE?"comment":t.tagName?t.tagName.toLowerCase():(console.error("Can't get node type for ",t),"unknown")},e.exports=n},{underscore:19}],14:[function(t,e){"use strict";var r=t("./util"),n={},i=function(t,e){e?(Error.call(this,t,e.fileName,e.lineNumber),this.__stack=e instanceof i?e.__stack:e.stack?r.parseStackTrace(e):r.callstack(1)):(Error.call(this,t),this.__stack=r.callstack(1)),this.message=t};i.Prototype=function(){this.name="SubstanceError",this.code=-1,this.toString=function(){return this.name+":"+this.message},this.toJSON=function(){return{name:this.name,message:this.message,code:this.code,stack:this.stack}},this.printStackTrace=function(){r.printStackTrace(this)}},i.Prototype.prototype=Error.prototype,i.prototype=new i.Prototype,Object.defineProperty(i.prototype,"stack",{get:function(){for(var t=[],e=0;e<this.__stack.length;e++){var r=this.__stack[e];t.push(r.file+":"+r.line+":"+r.col+" ("+r.func+")")}return t.join("\n")},set:function(){throw new Error("SubstanceError.stack is read-only.")}}),n.SubstanceError=i;var s=function(t,e,r){return function(n){t.call(this,n),this.name=e,this.code=r}};n.define=function(t,e,r){if(!t)throw new i("Name is required.");void 0===e&&(e=-1),r=r||i;var o=s(r,t,e),a=function(){};return a.prototype=r.prototype,o.prototype=new a,o.prototype.constructor=o,n[t]=o,o},e.exports=n},{"./util":18}],15:[function(t,e){"use strict";var r=t("underscore"),n=1,i=-1,s=function(t){this.levels=t||{}};s.Prototype=function(){var t=function(t,e){if(t.pos<e.pos)return-1;if(t.pos>e.pos)return 1;if(t.mode<e.mode)return-1;if(t.mode>e.mode)return 1;if(t.mode===n){if(t.level<e.level)return-1;if(t.level>e.level)return 1}if(t.mode===i){if(t.level>e.level)return-1;if(t.level<e.level)return 1}return 0},e=function(t){var e=[];return r.each(t,function(t){var r=this.levels[t.type]||1e3;void 0!==r&&(e.push({pos:t.range[0],mode:n,level:r,id:t.id,type:t.type,node:t}),e.push({pos:t.range[1],mode:i,level:r,id:t.id,type:t.type,node:t}))},this),e};this.onText=function(){},this.onEnter=function(){return null},this.onExit=function(){},this.enter=function(t,e){return this.onEnter(t,e)},this.exit=function(t,e){this.onExit(t,e)},this.createText=function(t,e){this.onText(t,e)},this.start=function(r,s,o){var a=e.call(this,o);a.sort(t.bind(this));for(var c=[{context:r,entry:null}],u=0,l=0;l<a.length;l++){var h=a[l];this.createText(c[c.length-1].context,s.substring(u,h.pos)),u=h.pos;var f,p=1;if(h.mode===n){for(;p<c.length&&!(h.level<c[p].entry.level);p++);c.splice(p,0,{entry:h})}else if(h.mode===i){for(;p<c.length&&c[p].entry.id!==h.id;p++);for(f=p;f<c.length;f++)this.exit(c[f].entry,c[f-1].context);c.splice(p,1)}for(f=p;f<c.length;f++)c[f].context=this.enter(c[f].entry,c[f-1].context)}this.createText(r,s.substring(u))}},s.prototype=new s.Prototype,e.exports=s},{underscore:19}],16:[function(t,e){"use strict";var r={},n=t("underscore");r.templates={},r.renderTemplate=function(t,e){return r.templates[t](e)},"undefined"!=typeof window&&(window.console||(window.console={log:function(){}})),r.tpl=function(t,e){e=e||{};var r=window.$("script[name="+t+"]").html();return n.template(r,e)},e.exports=r},{underscore:19}],17:[function(t,e){"use strict";var r=function(t){this.index=t.index,this.match=[];for(var e=0;e<t.length;e++)this.match.push(t[e])};r.Prototype=function(){this.captures=function(){return this.match.slice(1)},this.toString=function(){return this.match[0]}},r.prototype=new r.Prototype;var n=function(t){this.exp=t};n.Prototype=function(){this.match=function(t){if(void 0===t)throw new Error("No string given");if(this.exp.global){var e,n=[];for(this.exp.compile(this.exp);null!==(e=this.exp.exec(t));)n.push(new r(e));return n}return this.exp.exec(t)}},n.prototype=new n.Prototype,n.Match=r,e.exports=n},{}],18:[function(t,e){"use strict";var r=t("underscore"),n={};n.uuid=function(t,e){var r,n="0123456789abcdefghijklmnopqrstuvwxyz".split(""),i=[],s=16;if(e=e||32)for(r=0;e>r;r++)i[r]=n[0|Math.random()*s];else{var o;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;36>r;r++)i[r]||(o=0|16*Math.random(),i[r]=n[19==r?3&o|8:o])}return(t?t:"")+i.join("")},n.uuidGen=function(t){var e=1;return t=void 0!==t?t:"uuid_",function(r){return r=r||t,r+e++}};var i=function(t,e){var r,n=-1,i=t.length,s=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++n<i;)(r=t[n]).callback.call(r.ctx);return;case 1:for(;++n<i;)(r=t[n]).callback.call(r.ctx,s);return;case 2:for(;++n<i;)(r=t[n]).callback.call(r.ctx,s,o);return;case 3:for(;++n<i;)(r=t[n]).callback.call(r.ctx,s,o,a);return;default:for(;++n<i;)(r=t[n]).callback.apply(r.ctx,e)}},s=/\s+/,o=function(t,e,r,n){if(!r)return!0;if("object"==typeof r){for(var i in r)t[e].apply(t,[i,r[i]].concat(n));return!1}if(s.test(r)){for(var o=r.split(s),a=0,c=o.length;c>a;a++)t[e].apply(t,[o[a]].concat(n));return!1}return!0};n.Events={on:function(t,e,r){if(!o(this,"on",t,[e,r])||!e)return this;this._events=this._events||{};var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:r,ctx:r||this}),this},once:function(t,e,n){if(!o(this,"once",t,[e,n])||!e)return this;var i=this,s=r.once(function(){i.off(t,s),e.apply(this,arguments)});return s._callback=e,this.on(t,s,n)},off:function(t,e,n){var i,s,a,c,u,l,h,f;if(!this._events||!o(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(c=t?[t]:r.keys(this._events),u=0,l=c.length;l>u;u++)if(t=c[u],a=this._events[t]){if(this._events[t]=i=[],e||n)for(h=0,f=a.length;f>h;h++)s=a[h],(e&&e!==s.callback&&e!==s.callback._callback||n&&n!==s.context)&&i.push(s);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=Array.prototype.slice.call(arguments,1);if(!o(this,"trigger",t,e))return this;var r=this._events[t],n=this._events.all;return r&&i(r,e),n&&i(n,arguments),this},triggerLater:function(){var t=this,e=arguments;window.setTimeout(function(){t.trigger.apply(t,e)},0)},stopListening:function(t,e,r){var n=this._listeners;if(!n)return this;var i=!e&&!r;"object"==typeof e&&(r=this),t&&((n={})[t._listenerId]=t);for(var s in n)n[s].off(e,r,this),i&&delete this._listeners[s];return this}};var a={listenTo:"on",listenToOnce:"once"};r.each(a,function(t,e){n.Events[e]=function(e,n,i){var s=this._listeners||(this._listeners={}),o=e._listenerId||(e._listenerId=r.uniqueId("l"));return s[o]=e,"object"==typeof n&&(i=this),e[t](n,i,this),this}}),n.Events.bind=n.Events.on,n.Events.unbind=n.Events.off,n.Events.Listener={listenTo:function(t,e,n){if(!r.isFunction(n))throw new Error("Illegal argument: expecting function as callback, was: "+n);return this._handlers=this._handlers||[],t.on(e,n,this),this._handlers.push({unbind:function(){t.off(e,n)}}),this},stopListening:function(){if(this._handlers)for(var t=0;t<this._handlers.length;t++)this._handlers[t].unbind()}},n.propagate=function(t,e){if(!r.isFunction(e))throw"Illegal argument: provided callback is not a function";return function(r){return r?e(r):void e(null,t)}};var c=function(){};n.inherits=function(t,e,n){var i;return i=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},r.extend(i,t),c.prototype=t.prototype,i.prototype=new c,e&&r.extend(i.prototype,e),n&&r.extend(i,n),i.prototype.constructor=i,i.__super__=t.prototype,i},n.getJSON=function(e,r){if("undefined"==typeof window||"undefined"!=typeof nwglobal){var n=t("fs"),i=JSON.parse(n.readFileSync(e,"utf8"));r(null,i)}else{var s=window.$;s.getJSON(e).done(function(t){r(null,t)}).error(function(t){r(t,null)})}},n.prototype=function(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__},n.inherit=function(t,e){var n,i=r.isFunction(t)?new t:t;if(r.isFunction(e))e.prototype=i,n=new e;else{var s=function(){};s.prototype=i,n=r.extend(new s,e)}return n},n.pimpl=function(t){var e=function(t){this.self=t};return e.prototype=t,function(t){return t=t||this,new e(t)}},n.parseStackTrace=function(t){var e,r=/([^@]*)@(.*):(\d+)/,n=/\s*at ([^(]*)[(](.*):(\d+):(\d+)[)]/,i=t.stack.split("\n"),s=[];for(e=0;e<i.length;e++){var o=r.exec(i[e]);o||(o=n.exec(i[e]));var a;o?(a={func:o[1],file:o[2],line:o[3],col:o[4]||0},""===a.func&&(a.func="<anonymous>")):a={func:"",file:i[e],line:"",col:""},s.push(a)}return s},n.callstack=function(t){var e;try{throw new Error}catch(r){e=r}var i=n.parseStackTrace(e);return t=t||0,i.splice(t+1)},n.stacktrace=function(t){var e=0===arguments.length?n.callstack().splice(1):n.parseStackTrace(t),i=[];return r.each(e,function(t){i.push(t.file+":"+t.line+":"+t.col+" ("+t.func+")")}),i.join("\n")},n.printStackTrace=function(t,e){if(t.stack){var i;if(void 0!==t.__stack)i=t.__stack;else{if(!r.isString(t.stack))return;i=n.parseStackTrace(t)}e=e||i.length,e=Math.min(e,i.length);for(var s=0;e>s;s++){var o=i[s];console.log(o.file+":"+o.line+":"+o.col,"("+o.func+")")}}},n.diff=function(t,e){var i;return r.isArray(t)&&r.isArray(e)?(i=r.difference(e,t),0===i.length?null:i):r.isObject(t)&&r.isObject(e)?(i={},r.each(Object.keys(e),function(r){var s=n.diff(t[r],e[r]);s&&(i[r]=s)}),r.isEmpty(i)?null:i):t!==e?e:void 0},n.deepclone=function(t){return void 0===t?void 0:null===t?null:JSON.parse(JSON.stringify(t))},n.clone=function(t){return null===t||void 0===t?t:r.isFunction(t.clone)?t.clone():n.deepclone(t)},n.freeze=function(t){var e;if(r.isObject(t)){if(Object.isFrozen(t))return t;var i=Object.keys(t);for(e=0;e<i.length;e++){var s=i[e];t[s]=n.freeze(t[s])}return Object.freeze(t)}if(r.isArray(t)){var o=t;for(e=0;e<o.length;e++)o[e]=n.freeze(o[e]);return Object.freeze(o)}return t},n.later=function(t,e){return function(){var r=arguments;window.setTimeout(function(){t.apply(e,r)},0)}},n.isEmpty=function(t){return!t.match(/\w/)},n.slug=function(t){t=t.replace(/^\s+|\s+$/g,""),t=t.toLowerCase();for(var e="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",r="aaaaeeeeiiiioooouuuunc------",n=0,i=e.length;i>n;n++)t=t.replace(new RegExp(e.charAt(n),"g"),r.charAt(n));return t=t.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},n.getReadableFileSizeString=function(t){var e=-1,r=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do t/=1024,e++;while(t>1024);return Math.max(t,.1).toFixed(1)+r[e]},e.exports=n},{fs:31,underscore:19}],19:[function(t,e,r){(function(){var t=this,n=t._,i={},s=Array.prototype,o=Object.prototype,a=Function.prototype,c=s.push,u=s.slice,l=s.concat,h=o.toString,f=o.hasOwnProperty,p=s.forEach,d=s.map,g=s.reduce,v=s.reduceRight,y=s.filter,m=s.every,_=s.some,w=s.indexOf,b=s.lastIndexOf,x=Array.isArray,k=Object.keys,S=a.bind,E=function(t){return t instanceof E?t:this instanceof E?void(this._wrapped=t):new E(t)};"undefined"!=typeof r?("undefined"!=typeof e&&e.exports&&(r=e.exports=E),r._=E):t._=E,E.VERSION="1.5.2";var C=E.each=E.forEach=function(t,e,r){if(null!=t)if(p&&t.forEach===p)t.forEach(e,r);else if(t.length===+t.length){for(var n=0,s=t.length;s>n;n++)if(e.call(r,t[n],n,t)===i)return}else for(var o=E.keys(t),n=0,s=o.length;s>n;n++)if(e.call(r,t[o[n]],o[n],t)===i)return};E.map=E.collect=function(t,e,r){var n=[];return null==t?n:d&&t.map===d?t.map(e,r):(C(t,function(t,i,s){n.push(e.call(r,t,i,s))}),n)};var F="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(t,e,r,n){var i=arguments.length>2;if(null==t&&(t=[]),g&&t.reduce===g)return n&&(e=E.bind(e,n)),i?t.reduce(e,r):t.reduce(e);if(C(t,function(t,s,o){i?r=e.call(n,r,t,s,o):(r=t,i=!0)}),!i)throw new TypeError(F);return r},E.reduceRight=E.foldr=function(t,e,r,n){var i=arguments.length>2;if(null==t&&(t=[]),v&&t.reduceRight===v)return n&&(e=E.bind(e,n)),i?t.reduceRight(e,r):t.reduceRight(e);var s=t.length;if(s!==+s){var o=E.keys(t);s=o.length}if(C(t,function(a,c,u){c=o?o[--s]:--s,i?r=e.call(n,r,t[c],c,u):(r=t[c],i=!0)}),!i)throw new TypeError(F);return r},E.find=E.detect=function(t,e,r){var n;return T(t,function(t,i,s){return e.call(r,t,i,s)?(n=t,!0):void 0}),n},E.filter=E.select=function(t,e,r){var n=[];return null==t?n:y&&t.filter===y?t.filter(e,r):(C(t,function(t,i,s){e.call(r,t,i,s)&&n.push(t)}),n)},E.reject=function(t,e,r){return E.filter(t,function(t,n,i){return!e.call(r,t,n,i)},r)},E.every=E.all=function(t,e,r){e||(e=E.identity);var n=!0;return null==t?n:m&&t.every===m?t.every(e,r):(C(t,function(t,s,o){return(n=n&&e.call(r,t,s,o))?void 0:i}),!!n)};var T=E.some=E.any=function(t,e,r){e||(e=E.identity);var n=!1;return null==t?n:_&&t.some===_?t.some(e,r):(C(t,function(t,s,o){return n||(n=e.call(r,t,s,o))?i:void 0}),!!n)};E.contains=E.include=function(t,e){return null==t?!1:w&&t.indexOf===w?-1!=t.indexOf(e):T(t,function(t){return t===e})},E.invoke=function(t,e){var r=u.call(arguments,2),n=E.isFunction(e);return E.map(t,function(t){return(n?e:t[e]).apply(t,r)})},E.pluck=function(t,e){return E.map(t,function(t){return t[e]})},E.where=function(t,e,r){return E.isEmpty(e)?r?void 0:[]:E[r?"find":"filter"](t,function(t){for(var r in e)if(e[r]!==t[r])return!1;return!0})},E.findWhere=function(t,e){return E.where(t,e,!0)},E.max=function(t,e,r){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&E.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return C(t,function(t,i,s){var o=e?e.call(r,t,i,s):t;o>n.computed&&(n={value:t,computed:o})}),n.value},E.min=function(t,e,r){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&E.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return C(t,function(t,i,s){var o=e?e.call(r,t,i,s):t;o<n.computed&&(n={value:t,computed:o})}),n.value},E.shuffle=function(t){var e,r=0,n=[];return C(t,function(t){e=E.random(r++),n[r-1]=n[e],n[e]=t}),n},E.sample=function(t,e,r){return arguments.length<2||r?t[E.random(t.length-1)]:E.shuffle(t).slice(0,Math.max(0,e))};var P=function(t){return E.isFunction(t)?t:function(e){return e[t]}};E.sortBy=function(t,e,r){var n=P(e);return E.pluck(E.map(t,function(t,e,i){return{value:t,index:e,criteria:n.call(r,t,e,i)}}).sort(function(t,e){var r=t.criteria,n=e.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(n>r||void 0===n)return-1}return t.index-e.index}),"value")};var $=function(t){return function(e,r,n){var i={},s=null==r?E.identity:P(r);return C(e,function(r,o){var a=s.call(n,r,o,e);t(i,a,r)}),i}};E.groupBy=$(function(t,e,r){(E.has(t,e)?t[e]:t[e]=[]).push(r)}),E.indexBy=$(function(t,e,r){t[e]=r}),E.countBy=$(function(t,e){E.has(t,e)?t[e]++:t[e]=1}),E.sortedIndex=function(t,e,r,n){r=null==r?E.identity:P(r);for(var i=r.call(n,e),s=0,o=t.length;o>s;){var a=s+o>>>1;r.call(n,t[a])<i?s=a+1:o=a}return s},E.toArray=function(t){return t?E.isArray(t)?u.call(t):t.length===+t.length?E.map(t,E.identity):E.values(t):[]},E.size=function(t){return null==t?0:t.length===+t.length?t.length:E.keys(t).length},E.first=E.head=E.take=function(t,e,r){return null==t?void 0:null==e||r?t[0]:u.call(t,0,e)},E.initial=function(t,e,r){return u.call(t,0,t.length-(null==e||r?1:e))},E.last=function(t,e,r){return null==t?void 0:null==e||r?t[t.length-1]:u.call(t,Math.max(t.length-e,0))},E.rest=E.tail=E.drop=function(t,e,r){return u.call(t,null==e||r?1:e)},E.compact=function(t){return E.filter(t,E.identity)};var O=function(t,e,r){return e&&E.every(t,E.isArray)?l.apply(r,t):(C(t,function(t){E.isArray(t)||E.isArguments(t)?e?c.apply(r,t):O(t,e,r):r.push(t)}),r)};E.flatten=function(t,e){return O(t,e,[])},E.without=function(t){return E.difference(t,u.call(arguments,1))},E.uniq=E.unique=function(t,e,r,n){E.isFunction(e)&&(n=r,r=e,e=!1);
var i=r?E.map(t,r,n):t,s=[],o=[];return C(i,function(r,n){(e?n&&o[o.length-1]===r:E.contains(o,r))||(o.push(r),s.push(t[n]))}),s},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=function(t){var e=u.call(arguments,1);return E.filter(E.uniq(t),function(t){return E.every(e,function(e){return E.indexOf(e,t)>=0})})},E.difference=function(t){var e=l.apply(s,u.call(arguments,1));return E.filter(t,function(t){return!E.contains(e,t)})},E.zip=function(){for(var t=E.max(E.pluck(arguments,"length").concat(0)),e=new Array(t),r=0;t>r;r++)e[r]=E.pluck(arguments,""+r);return e},E.object=function(t,e){if(null==t)return{};for(var r={},n=0,i=t.length;i>n;n++)e?r[t[n]]=e[n]:r[t[n][0]]=t[n][1];return r},E.indexOf=function(t,e,r){if(null==t)return-1;var n=0,i=t.length;if(r){if("number"!=typeof r)return n=E.sortedIndex(t,e),t[n]===e?n:-1;n=0>r?Math.max(0,i+r):r}if(w&&t.indexOf===w)return t.indexOf(e,r);for(;i>n;n++)if(t[n]===e)return n;return-1},E.lastIndexOf=function(t,e,r){if(null==t)return-1;var n=null!=r;if(b&&t.lastIndexOf===b)return n?t.lastIndexOf(e,r):t.lastIndexOf(e);for(var i=n?r:t.length;i--;)if(t[i]===e)return i;return-1},E.range=function(t,e,r){arguments.length<=1&&(e=t||0,t=0),r=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/r),0),i=0,s=new Array(n);n>i;)s[i++]=t,t+=r;return s};var j=function(){};E.bind=function(t,e){var r,n;if(S&&t.bind===S)return S.apply(t,u.call(arguments,1));if(!E.isFunction(t))throw new TypeError;return r=u.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,r.concat(u.call(arguments)));j.prototype=t.prototype;var i=new j;j.prototype=null;var s=t.apply(i,r.concat(u.call(arguments)));return Object(s)===s?s:i}},E.partial=function(t){var e=u.call(arguments,1);return function(){return t.apply(this,e.concat(u.call(arguments)))}},E.bindAll=function(t){var e=u.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return C(e,function(e){t[e]=E.bind(t[e],t)}),t},E.memoize=function(t,e){var r={};return e||(e=E.identity),function(){var n=e.apply(this,arguments);return E.has(r,n)?r[n]:r[n]=t.apply(this,arguments)}},E.delay=function(t,e){var r=u.call(arguments,2);return setTimeout(function(){return t.apply(null,r)},e)},E.defer=function(t){return E.delay.apply(E,[t,1].concat(u.call(arguments,1)))},E.throttle=function(t,e,r){var n,i,s,o=null,a=0;r||(r={});var c=function(){a=r.leading===!1?0:new Date,o=null,s=t.apply(n,i)};return function(){var u=new Date;a||r.leading!==!1||(a=u);var l=e-(u-a);return n=this,i=arguments,0>=l?(clearTimeout(o),o=null,a=u,s=t.apply(n,i)):o||r.trailing===!1||(o=setTimeout(c,l)),s}},E.debounce=function(t,e,r){var n,i,s,o,a;return function(){s=this,i=arguments,o=new Date;var c=function(){var u=new Date-o;e>u?n=setTimeout(c,e-u):(n=null,r||(a=t.apply(s,i)))},u=r&&!n;return n||(n=setTimeout(c,e)),u&&(a=t.apply(s,i)),a}},E.once=function(t){var e,r=!1;return function(){return r?e:(r=!0,e=t.apply(this,arguments),t=null,e)}},E.wrap=function(t,e){return function(){var r=[t];return c.apply(r,arguments),e.apply(this,r)}},E.compose=function(){var t=arguments;return function(){for(var e=arguments,r=t.length-1;r>=0;r--)e=[t[r].apply(this,e)];return e[0]}},E.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},E.keys=k||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var r in t)E.has(t,r)&&e.push(r);return e},E.values=function(t){for(var e=E.keys(t),r=e.length,n=new Array(r),i=0;r>i;i++)n[i]=t[e[i]];return n},E.pairs=function(t){for(var e=E.keys(t),r=e.length,n=new Array(r),i=0;r>i;i++)n[i]=[e[i],t[e[i]]];return n},E.invert=function(t){for(var e={},r=E.keys(t),n=0,i=r.length;i>n;n++)e[t[r[n]]]=r[n];return e},E.functions=E.methods=function(t){var e=[];for(var r in t)E.isFunction(t[r])&&e.push(r);return e.sort()},E.extend=function(t){return C(u.call(arguments,1),function(e){if(e)for(var r in e)t[r]=e[r]}),t},E.pick=function(t){var e={},r=l.apply(s,u.call(arguments,1));return C(r,function(r){r in t&&(e[r]=t[r])}),e},E.omit=function(t){var e={},r=l.apply(s,u.call(arguments,1));for(var n in t)E.contains(r,n)||(e[n]=t[n]);return e},E.defaults=function(t){return C(u.call(arguments,1),function(e){if(e)for(var r in e)void 0===t[r]&&(t[r]=e[r])}),t},E.clone=function(t){return E.isObject(t)?E.isArray(t)?t.slice():E.extend({},t):t},E.tap=function(t,e){return e(t),t};var R=function(t,e,r,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof E&&(t=t._wrapped),e instanceof E&&(e=e._wrapped);var i=h.call(t);if(i!=h.call(e))return!1;switch(i){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=r.length;s--;)if(r[s]==t)return n[s]==e;var o=t.constructor,a=e.constructor;if(o!==a&&!(E.isFunction(o)&&o instanceof o&&E.isFunction(a)&&a instanceof a))return!1;r.push(t),n.push(e);var c=0,u=!0;if("[object Array]"==i){if(c=t.length,u=c==e.length)for(;c--&&(u=R(t[c],e[c],r,n)););}else{for(var l in t)if(E.has(t,l)&&(c++,!(u=E.has(e,l)&&R(t[l],e[l],r,n))))break;if(u){for(l in e)if(E.has(e,l)&&!c--)break;u=!c}}return r.pop(),n.pop(),u};E.isEqual=function(t,e){return R(t,e,[],[])},E.isEmpty=function(t){if(null==t)return!0;if(E.isArray(t)||E.isString(t))return 0===t.length;for(var e in t)if(E.has(t,e))return!1;return!0},E.isElement=function(t){return!(!t||1!==t.nodeType)},E.isArray=x||function(t){return"[object Array]"==h.call(t)},E.isObject=function(t){return t===Object(t)},C(["Arguments","Function","String","Number","Date","RegExp"],function(t){E["is"+t]=function(e){return h.call(e)=="[object "+t+"]"}}),E.isArguments(arguments)||(E.isArguments=function(t){return!(!t||!E.has(t,"callee"))}),"function"!=typeof/./&&(E.isFunction=function(t){return"function"==typeof t}),E.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},E.isNaN=function(t){return E.isNumber(t)&&t!=+t},E.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==h.call(t)},E.isNull=function(t){return null===t},E.isUndefined=function(t){return void 0===t},E.has=function(t,e){return f.call(t,e)},E.noConflict=function(){return t._=n,this},E.identity=function(t){return t},E.times=function(t,e,r){for(var n=Array(Math.max(0,t)),i=0;t>i;i++)n[i]=e.call(r,i);return n},E.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var A={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};A.unescape=E.invert(A.escape);var N={escape:new RegExp("["+E.keys(A.escape).join("")+"]","g"),unescape:new RegExp("("+E.keys(A.unescape).join("|")+")","g")};E.each(["escape","unescape"],function(t){E[t]=function(e){return null==e?"":(""+e).replace(N[t],function(e){return A[t][e]})}}),E.result=function(t,e){if(null==t)return void 0;var r=t[e];return E.isFunction(r)?r.call(t):r},E.mixin=function(t){C(E.functions(t),function(e){var r=E[e]=t[e];E.prototype[e]=function(){var t=[this._wrapped];return c.apply(t,arguments),D.call(this,r.apply(E,t))}})};var q=0;E.uniqueId=function(t){var e=++q+"";return t?t+e:e},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;E.template=function(t,e,r){var n;r=E.defaults({},r,E.templateSettings);var i=new RegExp([(r.escape||I).source,(r.interpolate||I).source,(r.evaluate||I).source].join("|")+"|$","g"),s=0,o="__p+='";t.replace(i,function(e,r,n,i,a){return o+=t.slice(s,a).replace(M,function(t){return"\\"+L[t]}),r&&(o+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=a+e.length,e}),o+="';\n",r.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(r.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(e)return n(e,E);var c=function(t){return n.call(this,t,E)};return c.source="function("+(r.variable||"obj")+"){\n"+o+"}",c},E.chain=function(t){return E(t).chain()};var D=function(t){return this._chain?E(t).chain():t};E.mixin(E),C(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];E.prototype[t]=function(){var r=this._wrapped;return e.apply(r,arguments),"shift"!=t&&"splice"!=t||0!==r.length||delete r[0],D.call(this,r)}}),C(["concat","join","slice"],function(t){var e=s[t];E.prototype[t]=function(){return D.call(this,e.apply(this._wrapped,arguments))}}),E.extend(E.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}],20:[function(t,e){var r={article_type:{doc_count_error_upper_bound:0,sum_other_doc_count:0,buckets:[{key:"Research article",doc_count:838},{key:"Insight",doc_count:186},{key:"Correction",doc_count:44},{key:"Feature article",doc_count:41},{key:"Short report",doc_count:32},{key:"Editorial",doc_count:11},{key:"Research advance",doc_count:13},{key:"Registered report",doc_count:8},{key:"Feature Article",doc_count:1}]},subjects:{doc_count_error_upper_bound:0,sum_other_doc_count:0,buckets:[{key:"Cell biology",doc_count:286},{key:"Neuroscience",doc_count:251},{key:"Biophysics and structural biology",doc_count:215},{key:"Biochemistry",doc_count:183},{key:"Developmental biology and stem cells",doc_count:162},{key:"Genomics and evolutionary biology",doc_count:152},{key:"Genes and chromosomes",doc_count:123},{key:"Microbiology and infectious disease",doc_count:124},{key:"Human biology and medicine",doc_count:88},{key:"Immunology",doc_count:62},{key:"Plant biology",doc_count:51},{key:"Ecology",doc_count:33},{key:"Epidemiology and global health",doc_count:21},{key:"Computational and systems biology",doc_count:2}]},organisms:{doc_count_error_upper_bound:0,sum_other_doc_count:246,buckets:[{key:"mouse",doc_count:195},{key:"human",doc_count:182},{key:"Mouse",doc_count:128},{key:"Human",doc_count:114},{key:"other",doc_count:116},{key:"D. melanogaster",doc_count:113},{key:"S. cerevisiae",doc_count:98},{key:"E. coli",doc_count:81},{key:"Other",doc_count:51},{key:"Arabidopsis",doc_count:39}]},authors:{doc_count_error_upper_bound:4,sum_other_doc_count:6627,buckets:[{key:"Randy Schekman",doc_count:14},{key:"Eve Marder",doc_count:9},{key:"Detlef Weigel",doc_count:9},{key:"Bill S Hansson",doc_count:7},{key:"Chris P Ponting",doc_count:6},{key:"Fiona M Watt",doc_count:5},{key:"Peter Walter",doc_count:6},{key:"Alma L Burlingame",doc_count:4},{key:"Irene Farabella",doc_count:4},{key:"Maya Topf",doc_count:4}]}};e.exports=r},{}],21:[function(t,e){var r=["synaptic plasticity","STDP","visual cortex","circuits","in vivo","spiking patterns","mouse","Circadian rhythms","transcription","nascent RNA","high-throughput sequencing","RNA processing","post-transcriptional regulation","Methanothermobacter marburgensis","cryo-electron microscopy","methanogenesis","hydrogenase"];e.exports=r},{}],22:[function(t,e){"use strict";var r=t("underscore"),n=(t("substance-util"),t("substance-application").Controller),i=t("./browser_view"),s=t("./search_query"),o=t("./search_result"),a=(t("./available_facets"),t("./available_keywords")),c={searchStr:"",filters:{}},u=function(t,e){n.call(this,t),this.config=e,this.searchQuery=new s(c),this.createView(),this.searchQuery.on("query:changed",r.bind(this.startSearch,this))};u.Prototype=function(){this.initialize=function(t,e){e(null)},this.DEFAULT_STATE={id:"main"},this.startSearch=function(){ga("send","event","search:"+this.searchQuery.searchStr,"search","search"),this.switchState({id:"main",searchQuery:this.searchQuery.toJSON()})},this.getSuggestions=function(t){var e=[];return r.each(a,function(r){r.toLowerCase().match(t.toLowerCase())&&e.push({value:r.replace(t,"<b>"+t+"</b>"),rawValue:r})}),e},this.createView=function(){return this.view||(this.view=new i(this)),this.view},this.transition=function(t,e){if(console.log("BrowserController.transition(%s -> %s)",this.state.id,t.id),"main"!==t.id)return console.log("state not explicitly handled",this.state,t),e(null);if("uninitialized"===this.state.id){console.log("setting initial query",t.searchQuery);var n;t.searchQuery?n=JSON.parse(JSON.stringify(t.searchQuery)):(n=c,t.searchQuery=JSON.parse(JSON.stringify(n))),this.searchQuery.setQuery(n)}return r.isEqual(t.searchQuery,this.state.searchQuery)?(console.log("no state change detected, skipping",this.state,t),e(null,{skip:!0})):void this.loadSearchResult(t,e)},this.loadPreview=function(t,e,n){var i=this;$.ajax({url:i.config.api_url+"/search/document?documentId="+encodeURIComponent(t)+"&searchString="+encodeURIComponent(e),dataType:"json",success:function(s){var o=r.last(t.split("."));s.document.id=t,s.document.url="http://lens.elifesciences.org/"+o,s.document.pdf_url="http://cdn.elifesciences.org/elife-articles/"+o+"/pdf/elife"+o+".pdf",s.searchStr=e,i.previewData=s,n(null)},error:function(t){console.error(t.responseText),n(t.responseText)}})},this.loadSearchResult=function(t,e){this.view.showLoading();var n=t.searchQuery,i=(t.documentId,this);$.ajax({url:this.config.api_url+"/search?searchQuery="+encodeURIComponent(JSON.stringify(n)),dataType:"json",success:function(t){console.log("search result:",t),r.each(t.hits.hits,function(t){var e=r.last(t._id.split("."));t._source.url="http://lens.elifesciences.org/"+e},this),i.searchResult=new o({searchQuery:i.searchQuery,result:t},{}),i.previewData=null,e(null)},error:function(t){console.error(t.responseText),e(t.responseText)}})},this.afterTransition=function(t){var e=this.state;this.view.afterTransition(t,e)}},u.Prototype.prototype=n.prototype,u.prototype=new u.Prototype,u.Controller=u,e.exports=u},{"./available_facets":20,"./available_keywords":21,"./browser_view":23,"./search_query":27,"./search_result":28,"substance-application":2,"substance-util":11,underscore:19}],23:[function(t,e){"use strict";var r=t("underscore"),n=t("substance-application").View,i=t("substance-application").$$,s=t("./searchbar_view"),o=t("./preview_view"),a=t("./facets_view"),c=t("./util"),u={"Research article":"research-article","Feature article":"feature-article",Insight:"insight",Correction:"correction","Short report":"short-report",Editorial:"editorial","Research advance":"research-advance","Registered report":"registered-report"},l=function(t){n.call(this),this.controller=t,this.$el.attr({id:"container"}),this.searchbarView=new s(this.controller.searchQuery,{getSuggestions:r.bind(this.controller.getSuggestions,this.controller)}),this.facetsEl=i("#facets"),this.documentsEl=i("#documents"),this.documentsEl.appendChild(i(".no-result",{text:"Loading documents ..."})),this.previewEl=i("#preview"),this.panelWrapperEl=i(".panel-wrapper"),this.panelWrapperEl.appendChild(this.facetsEl),this.panelWrapperEl.appendChild(this.documentsEl),this.panelWrapperEl.appendChild(this.previewEl),this.progressbarEl=i(".progress-bar",{html:'<div class="progress loading"></div>'}),this.$el.on("click",".available-facets .value",r.bind(this.toggleFilter,this)),this.$el.on("click",".document .toggle-preview",r.bind(this.togglePreview,this)),this.$el.on("click",".show-more",r.bind(this._preventDefault,this)),this.controller.searchQuery.on("query:changed",r.bind(this.renderFacets,this))};l.Prototype=function(){this._preventDefault=function(t){t.preventDefault()},this.togglePreview=function(t){t.preventDefault();var e=this.controller.searchQuery,r=$(t.currentTarget).parent(),n=r.attr("data-id"),i=this;ga("send","event","preview","click","preview");var s=r.find(".preview");s.length>0?s.toggle():(this.showLoading(),this.controller.loadPreview(n,e.searchStr,function(){i.renderPreview(),i.hideLoading()}))},this.toggleFilter=function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-facet"),r=$(t.currentTarget).attr("data-value");ga("send","event","filter:"+e+":"+r,"click","filters"),this.controller.searchQuery.toggleFilter(e,r)},this.showLoading=function(){$(".progress-bar").removeClass("done loading").show(),r.delay(function(){$(".progress-bar").addClass("loading")},10)},this.hideLoading=function(){$(this.loadingEl).hide(),$(".progress-bar").addClass("done"),r.delay(function(){$(".progress-bar").hide()},1e3)},this.afterTransition=function(t,e){"main"===e.id&&(r.isEqual(e.searchQuery,t.searchQuery)||(this.renderSearchResult(),this.hideLoading()))},this.renderPreview=function(){var t=this.controller.previewData,e=t.document.id;if(this.controller.previewData){var r=new o(t);this.$(".document").each(function(){e===this.dataset.id&&this.appendChild(r.render().el)})}},this.renderFacets=function(){this.facetsView=new a(this.controller.searchResult.getFacets()),this.facetsEl.innerHTML="",this.facetsEl.appendChild(this.facetsView.render().el)},this.renderSearchResult=function(){var t=this.controller.state.searchQuery.searchStr,e=this.controller.state.searchQuery.filters;if(this.controller.searchResult){this.documentsEl.innerHTML="";var n=this.controller.searchResult.getDocuments(),s=this.controller.searchResult.getSearchMetrics();n.length>0?(this.documentsEl.appendChild(i(".no-result",{text:s.hits+" articles found"})),r.each(n,function(n){var s=i(".filters");r.each(e,function(t,e){var o=n[e];r.isArray(o)||(o=[o]),r.each(t,function(t){if(r.include(o,t)){var e=i(".filter",{text:t});s.appendChild(e)}})});var a=[i(".meta-info",{children:[i(".article-type."+u[n.article_type],{html:n.article_type+" "}),i(".doi",{html:n.doi+" "}),i(".published-on",{text:"published on "+c.formatDate(n.published_on)})]}),i(".title",{children:[i("a",{href:n.url,target:"_blank",html:n.title})]})];n.intro&&a.push(i(".intro",{html:n.intro})),a.push(i(".authors",{html:n.authors_string})),s.childNodes.length>0&&a.push(s);var l=i(".document",{"data-id":n.id,children:a});if(n.fragments){var h=new o({document:n,fragments:n.fragments,searchStr:t});l.appendChild(h.render().el)}this.documentsEl.appendChild(l)},this)):this.documentsEl.appendChild(i(".no-result",{text:"Your search did not match any documents"})),this.renderFacets()}},this.render=function(){return this.el.innerHTML="",this.el.appendChild(this.searchbarView.render().el),this.el.appendChild(this.panelWrapperEl),this.el.appendChild(this.progressbarEl),this},this.dispose=function(){this.stopListening(),this.mainView&&this.mainView.dispose()}},l.Prototype.prototype=n.prototype,l.prototype=new l.Prototype,e.exports=l},{"./facets_view":24,"./preview_view":26,"./searchbar_view":29,"./util":30,"substance-application":2,underscore:19}],24:[function(t,e){"use strict";var r=t("underscore"),n=t("substance-application").View,i=t("substance-application").$$,s=function(t){n.call(this),this.facets=t,this.$el.addClass("facets")};s.Prototype=function(){this.render=function(){return this.el.innerHTML="",this.renderFacets(),this},this.renderFacets=function(){this.availableFacets=i(".available-facets"),r.each(this.facets,function(t){var e=i(".facet."+t.property);e.appendChild(i(".facet-name",{text:t.name}));var n=i(".facet-values");r.each(t.entries,function(e){var r;r=e.selected?"fa-check-square-o":"fa-square-o";var s=e.name,o=e.frequency,a=e.scoped_frequency,c=100*a/o,u=i("a.value"+(e.selected?".selected":"")+(0==a?".not-included":""),{href:"#","data-facet":t.property,"data-value":e.name,children:[i(".icon",{html:'<i class="fa '+r+'"></i>'}),i(".label",{html:s}),i(".frequency",{children:[i(".scoped-frequency-label",{text:e.scoped_frequency}),i(".total-frequency-label",{text:e.frequency}),i(".total-frequency-bar"),i(".scoped-frequency-bar",{style:"width: "+c+"%"})]})]});n.appendChild(u)},this),e.appendChild(n),this.availableFacets.appendChild(e)},this),this.el.appendChild(this.availableFacets)},this.dispose=function(){this.stopListening()}},s.Prototype.prototype=n.prototype,s.prototype=new s.Prototype,e.exports=s},{"substance-application":2,underscore:19}],25:[function(t,e){"use strict";var r=(t("underscore"),t("substance-application")),n=t("./browser_controller"),i=t("substance-application").DefaultRouter,s=function(t){r.call(this),this.controller=new n(this,t);var e=new i(this);this.setRouter(e)};s.Prototype=function(){var t=r.prototype;this.start=function(e){t.start.call(this,e),this.el.appendChild(this.controller.view.render().el),window.location.hash||this.switchState([{id:"main"}],{updateRoute:!0,replace:!0})}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,e.exports=s},{"./browser_controller":22,"substance-application":2,underscore:19}],26:[function(t,e){"use strict";var r=t("underscore"),n=t("substance-application").View,i=t("substance-application").$$,s=function(t){n.call(this),this.model=t,this.$el.addClass("preview")};s.Prototype=function(){this.render=function(){return this.renderPreview(),this},this.renderPreview=function(){this.el.innerHTML="";var t=i(".fragments");r.each(this.model.fragments,function(e){t.appendChild(i(".fragment",{children:[i(".separator"),i(".content",{html:e.content})]}))},this),this.el.appendChild(t)},this.dispose=function(){this.stopListening()}},s.Prototype.prototype=n.prototype,s.prototype=new s.Prototype,e.exports=s},{"substance-application":2,underscore:19}],27:[function(t,e){var r=t("underscore"),n=t("substance-util"),i=function(t){this.searchStr=t.searchStr,this.filters=t.filters};i.Prototype=function(){this.addFilter=function(t,e){this.filters[t]||(this.filters[t]=[]),this.filters[t].push(e),this.trigger("query:changed")},this.removeFilter=function(t,e){var n=this.filters[t];this.filters[t]=r.without(n,e),0===n.length&&delete this.filters[t],this.trigger("query:changed")},this.clearFilters=function(){this.filters={},this.trigger("query:changed")},this.hasFilter=function(t,e){var r=this.filters[t];return r?r.indexOf(e)>=0:!1},this.toggleFilter=function(t,e){this.hasFilter(t,e)?this.removeFilter(t,e):this.addFilter(t,e)},this.removeLastFilter=function(){console.log("TODO: Implement.")},this.updateSearchStr=function(t){this.searchStr=t,this.trigger("query:changed")},this.setQuery=function(t){this.searchStr=t.searchStr,this.filters=t.filters},this.toJSON=function(){return{searchStr:this.searchStr,filters:this.filters}}},i.Prototype.prototype=n.Events,i.prototype=new i.Prototype,e.exports=i},{"substance-util":11,underscore:19}],28:[function(t,e){var r=t("underscore"),n=t("./available_facets"),i={subjects:"Subjects",article_type:"Article Type",organisms:"Organisms",authors:"Top Authors"},s=function(t){this.rawResult=t.result,this.searchQuery=t.searchQuery};s.Prototype=function(){this.getSearchMetrics=function(){return{hits:this.rawResult.hits.total}},this.getDocuments=function(){var t=[];return r.each(this.rawResult.hits.hits,function(e){var n=JSON.parse(JSON.stringify(e._source));t.push(r.extend(n,{id:e._id,fragments:e.fragments,_score:e._score,title:e.highlight&&e.highlight.title?e.highlight.title[0]:e._source.title,authors_string:e.highlight&&e.highlight.authors_string?e.highlight.authors_string[0]:e._source.authors_string,intro:e.highlight&&e.highlight.intro?e.highlight.intro[0]:e._source.intro,doi:e.highlight&&e.highlight.doi?e.highlight.doi[0]:e._source.doi}))}),t},this.getScopedFrequency=function(t,e){var t=this.rawResult.aggregations[t];if(!t)return"0";var n=r.select(t.buckets,function(t){return t.key===e});return n.length>0?n[0].doc_count:"0"},this.getFacets=function(){var t=[],e=this,s=this.rawResult.aggregations;return r.each(i,function(i,o){var a=[];n[o]?r.each(n[o].buckets,function(t){a.push({name:t.key,frequency:t.doc_count,scoped_frequency:e.getScopedFrequency(o,t.key),selected:e.isSelected(o,t.key)})}):"authors"===o&&r.each(s.authors.buckets,function(t){a.push({name:t.key,frequency:t.doc_count,scoped_frequency:e.getScopedFrequency(o,t.key),selected:e.isSelected(o,t.key)})}),t.push({name:i,property:o,entries:a})}),t},this.isSelected=function(t,e){var r=this.searchQuery.filters[t];return r?r.indexOf(e)>=0:!1}},s.prototype=new s.Prototype,e.exports=s},{"./available_facets":20,underscore:19}],29:[function(t,e){"use strict";var r=t("underscore"),n=t("substance-application").View,i=t("substance-application").$$,s={subjects:"fa-tags",article_type:"fa-align-left",organisms:"fa-leaf"},o=function(t,e){n.call(this),this.searchQuery=t,this.options=e,this.$el.addClass("searchbar"),this.searchFieldEl=i(".search-field"),this.searchFieldFilters=i(".search-field-filters"),this.searchFieldEl.appendChild(this.searchFieldFilters),this.searchFieldInputEl=i("input.search-field-input",{type:"text",placeholder:"Enter search term"}),this.searchFieldEl.appendChild(this.searchFieldInputEl),this.searchButton=i("a.search-button",{href:"#",text:"Search"}),this.searchFieldEl.appendChild(this.searchButton),this.searchFieldSuggestionsEl=i(".search-field-suggestions"),$(this.searchFieldSuggestionsEl).hide(),this.searchFieldEl.appendChild(this.searchFieldSuggestionsEl),this.el.appendChild(this.searchFieldEl),$(this.searchFieldInputEl).keyup(r.bind(this._updateSuggestions,this)),$(this.searchFieldInputEl).keydown(r.bind(this._interpretKey,this)),$(this.searchFieldInputEl).blur(r.bind(this._hideSuggestions,this)),$(this.el).click(r.bind(this._hideSuggestions,this)),this.$el.on("click",".search-field-suggestion",r.bind(this._useKeyword,this)),this.$el.on("click",".remove-filter",r.bind(this._removeFilter,this)),this.$el.on("click",".clear-filters",r.bind(this._clearFilters,this)),$(this.searchFieldInputEl).change(r.bind(this._updateSearchStr,this)),this.searchQuery.on("query:changed",r.bind(this.updateView,this))};o.Prototype=function(){this._updateSearchStr=function(t){var e=$(this.searchFieldInputEl).val();this.searchQuery.updateSearchStr(e),t.preventDefault(),console.log("updating searchstr")},this._removeFilter=function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-facet"),r=$(t.currentTarget).attr("data-value");this.searchQuery.removeFilter(e,r)},this._clearFilters=function(t){t.preventDefault(),this.searchQuery.clearFilters()},this._interpretKey=function(t){$(t.currentTarget).val();40===t.keyCode?(this.nextSuggestion(),t.preventDefault()):38===t.keyCode?(this.prevSuggestion(),t.preventDefault()):13===t.keyCode&&this.chooseSuggestion()},this._updateSuggestions=function(t){var e=$(t.currentTarget).val();r.include([40,38,13],t.keyCode)||this.renderSuggestions(e)},this._hideSuggestions=function(){var t=this.searchFieldSuggestionsEl;r.delay(function(){$(t).hide()},200,this)},this._useKeyword=function(t){var e=$(t.currentTarget),r=e.attr("data-value");this._hideSuggestions(),$(this.searchFieldInputEl).val(r).focus(),this._updateSearchStr(t),t.preventDefault()},this.chooseSuggestion=function(){var t=this.$(".search-field-suggestion.active");t.length>0?t.trigger("click"):this._hideSuggestions()},this.render=function(){return this.updateView(),this},this.renderFilters=function(){this.searchFieldFilters.innerHTML="";var t=0;if(r.each(this.searchQuery.filters,function(e){r.each(e,function(e){var r=i(".search-field-filter",{html:e});3>t&&this.searchFieldFilters.appendChild(r),t+=1},this)},this),t>3){var e=i(".search-field-filter",{text:"and "+(t-3)+" more"});this.searchFieldFilters.appendChild(e)}if(t>0){var n=i(".search-field-filter",{children:[i("a.clear-filters",{href:"#",text:"Clear Filters"})]});this.searchFieldFilters.appendChild(n)}},this.updateView=function(){console.log("query changed... updating the view"),$(this.searchFieldInputEl).val(this.searchQuery.searchStr),this.renderFilters()},this.prevSuggestion=function(){var t=this.searchFieldSuggestionsEl.childNodes;if(t.length>0){var e=this.$(".search-field-suggestion.active");0===e.length?$(r.last(t)).addClass("active"):(e.removeClass("active"),e.prev().addClass("active"))}},this.nextSuggestion=function(){var t=this.searchFieldSuggestionsEl.childNodes;if(t.length>0){var e=this.$(".search-field-suggestion.active");0===e.length?$(t[0]).addClass("active"):(e.removeClass("active"),e.next().addClass("active"))}},this.renderSuggestions=function(t){var e=this.options.getSuggestions(t);return 0===e.length?void $(this.searchFieldSuggestionsEl).hide():(this.searchFieldSuggestionsEl.innerHTML="",r.each(e,function(t){var e=i("a.search-field-suggestion",{html:'<i class="fa '+s[t.facet]+'"></i> '+t.value,href:"#","data-value":t.rawValue,"data-facet":t.facet});this.searchFieldSuggestionsEl.appendChild(e)},this),void $(this.searchFieldSuggestionsEl).show())},this.dispose=function(){this.stopListening()}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,e.exports=o},{"substance-application":2,underscore:19}],30:[function(t,e){var r={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},n={};n.formatDate=function(t){var e=t.split("-");if(e.length>=3){var n=new Date(e[0],e[1]-1,e[2]);return n.toUTCString().slice(0,16)}if(2===e.length){var i=e[1].replace(/^0/,""),s=e[0];return r[i]+" "+s}return s},e.exports=n},{}],31:[function(){},{}]},{},[1]);